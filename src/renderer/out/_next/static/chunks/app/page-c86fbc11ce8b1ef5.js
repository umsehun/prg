(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{374:(e,t,a)=>{Promise.resolve().then(a.bind(a,1587))},1587:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>$});var s=a(4568),r=a(7620);let n=()=>(0,s.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 w-72 h-72 bg-theme-secondary rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"}),(0,s.jsx)("div",{className:"absolute top-0 right-0 w-72 h-72 bg-theme-accent rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"}),(0,s.jsx)("div",{className:"absolute bottom-0 left-1/4 w-72 h-72 bg-theme-primary rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"})]}),l=()=>(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-8xl md:text-9xl font-black mb-4 bg-clip-text text-transparent bg-gradient-to-r from-theme-secondary to-theme-accent animate-pulse",children:"PRG"}),(0,s.jsx)("p",{className:"text-xl md:text-2xl text-theme-text-light/80 mb-12 font-light",children:"A RHYTHM GAME EXPERIENCE"})]}),o=[{label:"Start Game",scene:"Select"},{label:".osz Import",scene:"OszImport"},{label:"Settings",scene:"Settings"}],i=e=>{let{onNavigate:t}=e;return(0,s.jsxs)("div",{className:"min-h-screen bg-theme-bg text-theme-text-light flex flex-col items-center justify-center p-8 overflow-hidden relative",children:[(0,s.jsx)(n,{}),(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center",children:[(0,s.jsx)(l,{}),(0,s.jsx)("div",{className:"space-y-6",children:o.map((e,a)=>(0,s.jsx)("button",{onClick:()=>t(e.scene),className:"group relative px-12 py-4 bg-theme-primary text-theme-text-light rounded-lg hover:bg-theme-primary/80 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:e.label},a))})]})]})};class c{static async loadAudio(e){try{let t=window.electron,a=await t.loadAsset(e),s=new Blob([a],{type:"audio/ogg"});return URL.createObjectURL(s)}catch(t){throw console.error("Failed to load audio asset: ".concat(e),t),Error("Failed to load audio: ".concat(e))}}static async loadImage(e){try{let t=window.electron,a=await t.loadAsset(e),s=new Blob([a],{type:"image/png"});return URL.createObjectURL(s)}catch(t){throw console.error("Failed to load image asset: ".concat(e),t),Error("Failed to load image: ".concat(e))}}static async exists(e){try{let t=window.electron;return await t.assetExists(e)}catch(t){return console.error("Failed to check asset existence: ".concat(e),t),!1}}static cleanup(e){e.startsWith("blob:")&&URL.revokeObjectURL(e)}}let d=e=>{let{bannerPath:t,title:a}=e,[n,l]=(0,r.useState)(null),[o,i]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null);return((0,r.useEffect)(()=>((async()=>{try{i(!0),u(null);let e=t.replace("/assets/",""),a=await c.loadImage(e);l(a)}catch(e){console.error("Failed to load banner image: ".concat(t),e),u("Failed to load image")}finally{i(!1)}})(),()=>{n&&c.cleanup(n)}),[t]),o)?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:(0,s.jsx)("div",{className:"text-white",children:"Loading..."})}):d||!n?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:(0,s.jsx)("div",{className:"text-white/70",children:"No Image"})}):(0,s.jsx)("img",{src:n,alt:a,className:"w-full h-full object-cover"})};var u=a(1620);let h={score:0,combo:0,maxCombo:0,judgment:null,judgments:{KOOL:0,COOL:0,GOOD:0,MISS:0},currentScene:"Start",isPaused:!1,charts:[],selectedChartId:null,gameMode:"pin"},m=(0,u.v)()((e,t)=>({...h,updateGame:a=>{let{combo:s,judgment:r}=a,n={...t().judgments};r&&r in n&&n[r]++,e(e=>({...a,maxCombo:Math.max(e.maxCombo,null!=s?s:e.combo),judgments:n}))},setCurrentScene:t=>e({currentScene:t}),togglePause:()=>e(e=>({isPaused:!e.isPaused})),setSelectedChart:t=>e({selectedChartId:t}),setGameMode:t=>e({gameMode:t}),loadCharts:async()=>{var a,s;if(t().charts.length>0)return;let r=await window.electron.discoverCharts();e({charts:r,selectedChartId:null!=(s=null==(a=r[0])?void 0:a.id)?s:null})},reset:()=>e(h)})),x=()=>(0,s.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-theme-secondary/10 rounded-full blur-3xl animate-pulse"}),(0,s.jsx)("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-theme-primary/10 rounded-full blur-3xl animate-pulse delay-1000"}),(0,s.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-theme-accent/5 rounded-full blur-3xl animate-pulse delay-500"})]}),f=e=>{let{onBack:t,onStartGame:a}=e,{charts:n,selectedChartId:l,setSelectedChart:o,setCurrentScene:i,loadCharts:c}=m(),[u,h]=(0,r.useState)(0),[f,g]=(0,r.useState)([]),[b,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{p(!0),console.log("[SelectScene] Starting auto-import of OSZ files...");let e=await window.electron.importAllOszFiles();e.imported>0?(console.log("[SelectScene] Auto-imported ".concat(e.imported," new charts")),await c()):e.skipped>0&&console.log("[SelectScene] ".concat(e.skipped," charts already existed")),e.errors.length>0&&console.warn("[SelectScene] Some charts failed to import:",e.errors)}catch(e){console.error("[SelectScene] Failed to auto-import OSZ files:",e)}finally{p(!1)}})().then(()=>{b||c()})},[]);let y=n.find(e=>e.id===l);(0,r.useEffect)(()=>{if(console.log("[DIFFICULTY DEBUG] Selected chart:",y),console.log("[DIFFICULTY DEBUG] Chart path:",null==y?void 0:y.chartPath),console.log("[DIFFICULTY DEBUG] Full chart object:",JSON.stringify(y,null,2)),y){var e;let t=(null==(e=y.oszMetadata)?void 0:e.difficulties)||y.difficulties;if(console.log("[DIFFICULTY DEBUG] Chart difficulties:",t),t&&t.length>1){let e=t.map(e=>e.name||"Difficulty ".concat(e.index+1));console.log("[DIFFICULTY DEBUG] Setting difficulties:",e),g(e),h(0)}else console.log("[DIFFICULTY DEBUG] No multiple difficulties found, clearing array"),g([]),h(0)}else console.log("[DIFFICULTY DEBUG] No chart selected, clearing difficulties"),g([]),h(0)},[y]);let v=async()=>{if(y)try{let e;(e=y.chartPath.endsWith(".osz")?await window.electron.convertOszToPinChart(y,u):await window.electron.loadPinChart(y.chartPath))&&a(e)}catch(e){console.error("Failed to load chart:",e)}};return(0,s.jsxs)("div",{className:"min-h-screen cyber-bg-animated flex flex-col items-center justify-center p-4 text-white",children:[(0,s.jsx)(x,{}),(0,s.jsxs)("div",{className:"w-full max-w-7xl h-[85vh] game-card flex p-6 z-10 gap-6",children:[(0,s.jsxs)("div",{className:"w-1/3 flex flex-col",children:[(0,s.jsxs)("h2",{className:"text-3xl font-black mb-4 neon-glow-cyan",style:{color:"var(--neon-cyan)"},children:["SELECT MUSIC",b&&(0,s.jsx)("span",{className:"text-sm font-normal text-yellow-400 ml-3",children:"(Importing OSZ files...)"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto pr-2 space-y-2 max-h-[calc(85vh-120px)]",children:b&&0===n.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-gray-400",children:"Loading charts..."}),(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-400 mx-auto mt-4"})]}):n.map(e=>(0,s.jsxs)("button",{onClick:()=>o(e.id),className:"w-full text-left p-4 rounded-lg transition-all duration-300 transform hover:scale-102 ".concat(l===e.id?"neon-glow-magenta border-2":"bg-white/10 hover:bg-white/20 border border-transparent hover:border-cyan-400"),style:{backgroundColor:l===e.id?"rgba(255, 0, 255, 0.2)":void 0,borderColor:l===e.id?"var(--neon-magenta)":void 0},children:[(0,s.jsx)("p",{className:"font-bold text-lg truncate",style:{color:l===e.id?"var(--neon-magenta)":"white"},children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-400 truncate",children:e.artist})]},e.id))})]}),(0,s.jsxs)("div",{className:"w-2/3 flex flex-col justify-between",children:[y?(0,s.jsxs)("div",{className:"flex-grow flex flex-col items-center justify-center text-center px-4",children:[(0,s.jsx)("div",{className:"relative w-full max-w-lg h-48 rounded-xl shadow-2xl mb-6 border-2 neon-glow-green overflow-hidden",style:{borderColor:"var(--neon-green)"},children:(0,s.jsx)(d,{bannerPath:y.bannerPath||"",title:y.title})}),(0,s.jsx)("h1",{className:"text-4xl font-extrabold tracking-tight mb-2 neon-glow-pulse",style:{color:"var(--neon-cyan)"},children:y.title}),(0,s.jsx)("p",{className:"text-xl text-gray-300 mb-6",style:{color:"var(--neon-yellow)"},children:y.artist}),f.length>1&&(0,s.jsxs)("div",{className:"w-full max-w-md",children:[(0,s.jsx)("h3",{className:"text-xl font-bold mb-4 neon-glow-green",style:{color:"var(--neon-green)"},children:"Select Difficulty"}),(0,s.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-2 p-2 rounded-lg bg-black/20",children:f.map((e,t)=>(0,s.jsx)("button",{onClick:()=>h(t),className:"w-full px-4 py-2 rounded-lg text-left transition-all duration-300 transform hover:scale-105 ".concat(u===t?"neon-glow-yellow font-bold":"bg-white/10 hover:bg-white/20 text-white hover:neon-glow-cyan"),style:{backgroundColor:u===t?"rgba(255, 255, 0, 0.2)":void 0,color:u===t?"var(--neon-yellow)":void 0},children:e},t))})]})]}):(0,s.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-2xl text-gray-400",children:"Select a song to begin"})}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-6",children:[(0,s.jsx)("button",{onClick:t,className:"game-button",style:{borderColor:"var(--neon-red)",boxShadow:"0 0 10px var(--neon-red)"},children:"← Back to Menu"}),(0,s.jsx)("button",{onClick:v,disabled:!y,className:"px-12 py-4 text-2xl font-bold rounded-lg transition-all duration-300 transform ".concat(y?"game-button hover:scale-105 neon-glow-pulse":"bg-gray-600 cursor-not-allowed text-gray-400"),style:y?{borderColor:"var(--neon-green)",boxShadow:"0 0 20px var(--neon-green)",color:"var(--neon-green)"}:{},children:"GAME START"})]})]})]})]})};var g=a(1640),b=a.n(g);let p=e=>{let{radius:t,scale:a,opacity:r}=e,n=2*t*a;return(0,s.jsx)("div",{className:"absolute rounded-full border-4 border-white/80 pointer-events-none",style:{width:"".concat(n,"px"),height:"".concat(n,"px"),left:"50%",top:"50%",transform:"translate(-50%, -50%)",opacity:r,boxShadow:"0 0 16px rgba(255,255,255,0.35)",transition:"all 0.1s linear",borderColor:a>1.2?"rgba(255, 255, 255, 0.4)":a>1.05?"rgba(255, 255, 255, 0.6)":"rgba(255, 255, 255, 0.9)"}})};var y=a(8975);let v={KOOL:{color:"#00ffff",shadow:"0 0 20px #00ffff"},COOL:{color:"#0099ff",shadow:"0 0 15px #0099ff"},GOOD:{color:"#00ff00",shadow:"0 0 10px #00ff00"},MISS:{color:"#ff0000",shadow:"0 0 10px #ff0000"}},w=e=>{let{judgment:t}=e,a=(0,y.pn)(t?[t]:[],{from:{opacity:0,transform:"scale(0.5) translateY(50px)"},enter:{opacity:1,transform:"scale(1) translateY(0px)"},leave:{opacity:0,transform:"scale(0.5) translateY(-50px)"},config:{tension:280,friction:20},keys:e=>"".concat(e,"-").concat(Date.now())});return(0,s.jsx)("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 -translate-y-1/2 z-30 pointer-events-none",children:a((e,t)=>(0,s.jsx)(y.CS.div,{style:e,className:"text-7xl font-black uppercase tracking-widest",children:(0,s.jsx)("span",{style:{color:v[t].color,textShadow:v[t].shadow},children:t})}))})};var j=a(9477);class N{static getInstance(){return N.instance||(N.instance=new N),N.instance}_toArrayBuffer(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array){let t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength&&t.buffer instanceof ArrayBuffer?t.buffer:t.slice().buffer}if(e&&"Buffer"===e.type&&Array.isArray(e.data))return new Uint8Array(e.data).buffer;throw Error("Received invalid data type for audio asset: ".concat(typeof e))}setupGainNodes(){this.audioContext&&(this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.hitsoundGainNode=this.audioContext.createGain(),this.hitsoundGainNode.connect(this.audioContext.destination))}async loadAudio(e){if(!this.audioContext)throw Error("AudioContext not initialized");try{let t=await window.electron.loadAsset(e),a=this._toArrayBuffer(t);this.currentBuffer=await this.audioContext.decodeAudioData(a)}catch(e){throw console.error("Failed to load audio:",e),e}}async loadHitsound(e,t){if(!this.hitsoundBuffers.has(e)&&t)try{console.log("[AudioService] Loading hitsound '".concat(e,"' from: ").concat(t));let a=await window.electron.loadAsset(t),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength);try{let t=await this.audioContext.decodeAudioData(s);this.hitsoundBuffers.set(e,t),console.log("[AudioService] Successfully loaded hitsound '".concat(e,"'"))}catch(t){console.warn("[AudioService] Failed to decode audio data for hitsound '".concat(e,"':"),t),console.warn("[AudioService] This is likely due to invalid or corrupted audio file format. Skipping this hitsound.");return}}catch(a){console.error("[AudioService] FAILED to load hitsound ".concat(e," from ").concat(t,":"),a)}}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.audioContext||!this.currentBuffer||!this.gainNode)return void console.warn("Cannot play: AudioContext, buffer, or gain node not available");this.stop(),this.currentSource=this.audioContext.createBufferSource(),this.currentSource.buffer=this.currentBuffer,this.currentSource.connect(this.gainNode),this.startTime=this.audioContext.currentTime,this.pauseTime=0,this.isPlaying=!0,this.isPaused=!1,this.currentSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this.endedListeners.forEach(e=>e())},this.currentSource.start(0,e)}pause(){this.currentSource&&this.isPlaying&&!this.isPaused&&(this.currentSource.stop(),this.pauseTime=this.getCurrentTime(),this.isPlaying=!1,this.isPaused=!0)}resume(){this.isPaused&&this.pauseTime>0&&this.play(this.pauseTime)}stop(){this.currentSource&&(this.currentSource.stop(),this.currentSource=null),this.isPlaying=!1,this.isPaused=!1,this.startTime=0,this.pauseTime=0}playHitsound(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!this.audioContext||!this.hitsoundGainNode)return;let a=this.hitsoundBuffers.get(e);if(!a)return void console.warn("Hitsound not found: ".concat(e));let s=this.audioContext.createBufferSource(),r=this.audioContext.createGain();s.buffer=a,r.gain.value=t,s.connect(r),r.connect(this.hitsoundGainNode),s.start(),s.onended=()=>{s.disconnect(),r.disconnect()}}getCurrentTime(){return this.audioContext?this.isPaused?this.pauseTime:this.isPlaying&&this.startTime>0?this.audioContext.currentTime-this.startTime:0:0}getDuration(){return this.currentBuffer?this.currentBuffer.duration:0}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.gainNode&&(this.gainNode.gain.value=this.volume)}setHitsoundVolume(e){this.hitsoundGainNode&&(this.hitsoundGainNode.gain.value=Math.max(0,Math.min(1,e)))}getIsPlaying(){return this.isPlaying}getIsPaused(){return this.isPaused}onEnded(e){return this.endedListeners.add(e),()=>this.endedListeners.delete(e)}seekTo(e){this.isPlaying?this.play(e):this.pauseTime=e}constructor(){(0,j._)(this,"audioContext",null),(0,j._)(this,"currentSource",null),(0,j._)(this,"currentBuffer",null),(0,j._)(this,"startTime",0),(0,j._)(this,"pauseTime",0),(0,j._)(this,"isPlaying",!1),(0,j._)(this,"isPaused",!1),(0,j._)(this,"volume",1),(0,j._)(this,"gainNode",null),(0,j._)(this,"hitsoundSources",new Map),(0,j._)(this,"hitsoundBuffers",new Map),(0,j._)(this,"hitsoundGainNode",null),(0,j._)(this,"endedListeners",new Set),this.audioContext=new window.AudioContext,this.setupGainNodes()}}(0,j._)(N,"instance",void 0);let S=N.getInstance(),C=e=>{var t;let{chart:n,onPinThrow:l,score:o,combo:i,judgment:c,noteSpeed:d}=e;console.log("[PinGameView] Component mounted with chart:",null==n?void 0:n.title);let[u,h]=(0,r.useState)([]),[m,x]=(0,r.useState)(!1),f=(0,r.useRef)(0),{knives:g,throwKnife:y,getKnivesPositions:v,setHitCallback:j,setActiveNotes:N,setJudgmentWindows:C,updateGameTime:k}=(e=>{let{targetRadius:t,velocity:s=400,rotationSpeed:n=540,isGameActive:l}=e,[o,i]=(0,r.useState)([]),c=(0,r.useRef)(null),d=(0,r.useRef)(0),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{console.log("[useKnifePhysics] Initializing physics worker...");try{let e=new Worker(a.tu(new URL(a.p+a.u(475),a.b)));return c.current=e,console.log("[useKnifePhysics] Worker created, sending INIT message"),e.postMessage({type:"INIT",payload:{targetRadius:t,velocity:s,rotationSpeed:n}}),e.onmessage=e=>{let{type:t,payload:a}=e.data;console.log("[useKnifePhysics] Worker message:",t,a),"UPDATE"===t?i(a.knives):"HIT"===t&&(console.log("[useKnifePhysics] Hit detected:",a),u.current&&u.current(a))},e.onerror=e=>{console.error("[useKnifePhysics] Worker error:",e)},()=>{console.log("[useKnifePhysics] Terminating worker"),e.terminate()}}catch(e){console.error("[useKnifePhysics] Failed to create worker:",e)}},[t,s,n]);let h=(0,r.useCallback)(()=>{if(console.log("[useKnifePhysics] throwKnife called, isGameActive:",l,"worker:",!!c.current),!l||!c.current)return void console.log("[useKnifePhysics] Cannot throw knife - game inactive or no worker");let e={id:d.current++,isStuck:!1,stuckAngle:0,thrownAt:Date.now(),position:{x:0,y:250,rotation:0}};console.log("[useKnifePhysics] Throwing knife:",e),c.current.postMessage({type:"THROW",payload:{knife:e}})},[l]),m=(0,r.useCallback)(()=>o.map(e=>({knife:e,position:e.position})),[o]),x=(0,r.useCallback)(e=>{u.current=e},[]),f=(0,r.useCallback)(e=>{console.log("[useKnifePhysics] Setting active notes:",e.length),c.current&&c.current.postMessage({type:"SET_NOTES",payload:{notes:e}})},[]),g=(0,r.useCallback)(e=>{console.log("[useKnifePhysics] Setting judgment windows:",e),c.current&&c.current.postMessage({type:"SET_JUDGMENT_WINDOWS",payload:{windows:e}})},[]),b=(0,r.useCallback)(e=>{c.current&&c.current.postMessage({type:"UPDATE_GAME_TIME",payload:{gameTime:e}})},[]),p=(0,r.useCallback)(()=>{c.current&&c.current.postMessage({type:"RESET"}),i([]),d.current=0},[]),y=o.filter(e=>e.isStuck).length;return{knives:o,throwKnife:h,getKnivesPositions:m,resetKnives:p,stuckKnivesCount:y,setHitCallback:x,setActiveNotes:f,setJudgmentWindows:g,updateGameTime:b}})({targetRadius:80,velocity:400,rotationSpeed:540,isGameActive:!0});(0,r.useEffect)(()=>{let e=setInterval(()=>{let e=1e3*S.getCurrentTime();f.current=e,k(e)},16);return()=>clearInterval(e)},[k]),(0,r.useEffect)(()=>{if(null==n?void 0:n.notes){var e,t;console.log("[PinGameView] Setting active notes for physics:",n.notes.length),N(n.notes.map(e=>({time:1e3*e.time})));let a=null!=(t=null==(e=n.metadata)?void 0:e.overallDifficulty)?t:5,s=140-8*a,r=200-10*a,l=Math.max(r+40,s+20),o={KOOL:Math.max(80-6*a,15),COOL:Math.max(s,50),GOOD:Math.max(r,100),MISS:Math.max(l,150)};console.log("[PinGameView] Setting judgment windows:",o),C(o)}},[n,N,C]),(0,r.useEffect)(()=>{j(e=>{console.log("[PinGameView] Physics hit:",e),e.judgment&&l(e.judgment)})},[j,l]),(0,r.useEffect)(()=>{if(!(null==n?void 0:n.notes))return;let e=setInterval(()=>{let e=f.current;h(n.notes.filter(t=>{let a=1e3*t.time-e;return a>0&&a<=2e3}).map(t=>{let a=1e3*t.time,s=a-e,r=Math.max(.1,s/2e3);return{id:"circle-".concat(t.time),noteTime:a,startTime:e-(2e3-s),scale:r}}))},100);return()=>clearInterval(e)},[n,2e3]);let O=(0,r.useCallback)(()=>{m||(console.log("[PinGameView] Throwing knife at time:",f.current),console.log("[PinGameView] Current knives before throw:",(null==g?void 0:g.length)||0),x(!0),y(),setTimeout(()=>x(!1),150))},[m,y,g]);(0,r.useEffect)(()=>{let e=e=>{"KeyS"!==e.code||m||O()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[O,m]);let E=v();return console.log("[PinGameView] Knives:",(null==g?void 0:g.length)||0,"KnifePositions:",(null==E?void 0:E.length)||0),(null==E?void 0:E.length)>0&&console.log("[PinGameView] First knife position:",E[0]),(0,s.jsxs)("div",{style:{zIndex:10},className:"jsx-532d500bfc6d5d04 min-h-screen relative overflow-hidden flex flex-col items-center justify-center bg-gray-900",children:[(0,s.jsxs)("div",{style:{width:"100vw",height:"100vh",zIndex:10},className:"jsx-532d500bfc6d5d04 relative flex items-center justify-center",children:[(0,s.jsx)("div",{style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"".concat(160,"px"),height:"".concat(160,"px")},className:"jsx-532d500bfc6d5d04 absolute flex items-center justify-center",children:(0,s.jsx)("div",{style:{animation:"spin 5s linear infinite"},className:"jsx-532d500bfc6d5d04 w-full h-full rounded-full border-4 border-white flex items-center justify-center",children:(0,s.jsx)("div",{className:"jsx-532d500bfc6d5d04 text-white text-lg font-bold",children:"TARGET"})})}),u.map(e=>(0,s.jsx)(p,{radius:80,scale:e.scale,opacity:Math.max(.3,e.scale)},e.id)),E.map(e=>{let{knife:t,position:a}=e;return(0,s.jsxs)("div",{style:{left:"50%",top:"50%",transform:"translate(-50%, -50%) translate(".concat(a.x,"px, ").concat(a.y,"px) rotate(").concat(a.rotation,"deg)"),transformOrigin:"center center"},className:"jsx-532d500bfc6d5d04 absolute",children:[(0,s.jsx)("div",{style:{width:"0",height:"0",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"20px solid #e5e7eb",top:"-20px",left:"-6px",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},className:"jsx-532d500bfc6d5d04 absolute bg-gradient-to-r from-gray-300 to-gray-100"}),(0,s.jsx)("div",{style:{width:"12px",height:"40px",borderRadius:"2px",boxShadow:"inset 0 1px 2px rgba(0,0,0,0.2), 0 2px 4px rgba(0,0,0,0.3)",transform:"translateX(-6px)"},className:"jsx-532d500bfc6d5d04 bg-gradient-to-r from-amber-800 to-amber-600"})]},t.id)})]}),(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04 absolute top-4 left-4 text-white text-lg",children:[(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04",children:["Score: ",o]}),(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04",children:["Combo: ",i]}),(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04",children:["Knives: ",g.length]})]}),(0,s.jsx)(w,{judgment:c}),(0,s.jsx)("div",{className:"jsx-532d500bfc6d5d04 absolute bottom-4 left-4 text-white text-sm",children:"Press S to throw knife"}),(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04 absolute top-4 right-4 bg-black/50 text-white p-2 text-sm rounded",children:[(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04",children:["Chart: ",null==n?void 0:n.title]}),(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04",children:["Notes: ",(null==n||null==(t=n.notes)?void 0:t.length)||0]}),(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04",children:["Time: ",(f.current/1e3).toFixed(1),"s"]}),(0,s.jsxs)("div",{className:"jsx-532d500bfc6d5d04",children:["Circles: ",u.length]})]}),(0,s.jsx)(b(),{id:"532d500bfc6d5d04",children:"@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}"})]})};function k(e,t,a){return Math.max(t,Math.min(a,e))}let O=e=>{let{hitErrors:t,maxErrorMs:a}=e,r=t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0;return(0,s.jsxs)("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 w-72 h-4 bg-transparent flex items-center justify-center pointer-events-none",children:[(0,s.jsx)("div",{className:"w-full h-1 bg-black/30 rounded-full overflow-hidden",children:(0,s.jsxs)("div",{className:"absolute w-full h-full flex justify-between items-center",children:[(0,s.jsx)("div",{className:"w-[3px] h-[3px] bg-cyan-400 rounded-full"}),(0,s.jsx)("div",{className:"w-[3px] h-[3px] bg-green-400 rounded-full"}),(0,s.jsx)("div",{className:"w-[3px] h-[3px] bg-yellow-400 rounded-full"})]})}),(0,s.jsx)("div",{className:"absolute w-full h-full",children:t.map((e,r)=>(0,s.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 w-1 h-3 bg-white/80 rounded-full shadow-lg transition-all duration-300 ease-out",style:{left:"".concat(50+e/a*50,"%"),opacity:1-(t.length-1-r)*.1}},r))}),(0,s.jsx)("div",{className:"absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-0.5 bg-cyan-300 shadow-lg"}),(0,s.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-yellow-300 transition-all duration-200 ease-in-out",style:{left:"".concat(50+r/a*50,"%")}})]})},E={KOOL:"#00ffff",COOL:"#88ff88",GOOD:"#ffcc22",MISS:"#ff6666"},P=e=>{let{judgment:t,hitError:a,onAnimationEnd:r}=e,[n,l]=(0,y.zh)(()=>({from:{opacity:0,transform:"scale(0.8) translateY(20px)"},to:{opacity:1,transform:"scale(1) translateY(0px)"},config:{tension:300,friction:15},onRest:()=>{setTimeout(()=>{l.start({to:{opacity:0,transform:"scale(1) translateY(-30px)"},config:{tension:300,friction:20},onRest:r})},400)}})),o="KOOL"===t&&Math.abs(a)>2?a<0?"#88ccff":"#ff8888":E[t];return(0,s.jsx)(y.CS.div,{style:n,className:"absolute text-2xl font-bold uppercase pointer-events-none -translate-x-1/2 -translate-y-1/2",children:(0,s.jsx)("span",{style:{color:o,textShadow:"0 0 8px ".concat(o)},children:t})})},G=e=>{let{onAnimationEnd:t,color:a}=e,[r]=(0,y.wR)(8,e=>({from:{opacity:1,scale:0,x:0,y:0},to:{opacity:0,scale:1.5,x:(Math.random()-.5)*150,y:(Math.random()-.5)*150},config:{mass:1,tension:400,friction:30},onRest:()=>{7===e&&t()}}));return(0,s.jsx)("div",{className:"absolute w-1 h-1",children:r.map((e,t)=>(0,s.jsx)(y.CS.div,{className:"absolute rounded-full",style:{...e,width:"8px",height:"8px",backgroundColor:a,boxShadow:"0 0 10px ".concat(a)}},t))})},I={KOOL:"#00ffff",COOL:"#88ff88",GOOD:"#ffcc22",MISS:"#ff6666"},T=e=>{var t,a,n,l,o;let{chart:i}=e,{score:c,combo:d,judgment:u,isPaused:h,updateGame:x,togglePause:f,reset:g}=m(),[b,y]=(0,r.useState)([]),[v,w]=(0,r.useState)([]),[j,N]=(0,r.useState)([]),[C,E]=(0,r.useState)([]),T=(0,r.useRef)(0),L=(o=null!=(n=null==(t=i.metadata)?void 0:t.approachRate)?n:5)<=5?1800-120*o:1200-150*(o-5),{w300:M}=function(e){return{w300:80-6*e,w100:140-8*e,w50:200-10*e}}(null!=(l=null==(a=i.metadata)?void 0:a.overallDifficulty)?l:5);(0,r.useEffect)(()=>{let e=window.electron.onGameUpdate(e=>{if(e.judgment&&void 0!==e.hitError){let t=D(i.notes.findIndex(t=>t.time===1e3*e.noteTime)%8/8*360,150),a="".concat(Date.now()),s=I[e.judgment]||"#ffffff";if(w(s=>[...s,{id:a,judgment:e.judgment,hitError:e.hitError,x:t.x,y:t.y}]),"MISS"!==e.judgment){N(e=>[...e,{id:a,x:t.x,y:t.y,color:s}]);try{S.playHitsound("normal-hitnormal")}catch(e){}}}void 0!==e.hitError&&y(t=>[...t.slice(-19),e.hitError]),x(e)});return()=>{e()}},[x,i.notes]);let D=(e,t)=>{let a=Math.PI/180*(e-90);return{x:Math.cos(a)*t,y:Math.sin(a)*t}};(0,r.useEffect)(()=>{let e,t=()=>{let a=1e3*S.getCurrentTime();T.current=a,E(i.notes.filter(e=>{let t=1e3*e.time;return a>=t-L&&a<=t+250})),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>cancelAnimationFrame(e)},[i.notes,L]);let A=(0,r.useCallback)(()=>{h||window.electron.handlePinPress(S.getCurrentTime())},[h]);return(0,s.jsxs)("div",{className:"absolute inset-0 cursor-pointer",onClick:A,children:[j.map(e=>(0,s.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(calc(-50% + ".concat(e.x,"px), calc(-50% + ").concat(e.y,"px))")},children:(0,s.jsx)(G,{color:e.color,onAnimationEnd:()=>N(t=>t.filter(t=>t.id!==e.id))})},e.id)),v.map(e=>(0,s.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(calc(-50% + ".concat(e.x,"px), calc(-50% + ").concat(e.y,"px))")},children:(0,s.jsx)(P,{judgment:e.judgment,hitError:e.hitError,onAnimationEnd:()=>w(t=>t.filter(t=>t.id!==e.id)),id:e.id})},e.id)),(0,s.jsx)(O,{hitErrors:b,maxErrorMs:M}),C.map(e=>{let t=1e3*e.time,a=t-L,r=T.current,n=function(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return s+(1-s)*k(1-(t-e)/a,0,1)}(r,t,L,2),l=function(e,t,a){let s=k((e-t)/(.4*a),0,1);return s*s*(3-2*s)}(r,a,L);return(0,s.jsxs)("div",{className:"absolute left-1/2 top-1/2",style:{transform:"translate(-50%, -50%)"},children:[(0,s.jsx)("div",{className:"absolute rounded-full bg-blue-500/50 border-2 border-white shadow",style:{width:"".concat(96,"px"),height:"".concat(96,"px"),opacity:l,boxShadow:"0 0 24px rgba(59,130,246,0.45)"}}),(0,s.jsx)(p,{radius:48,scale:n,opacity:l})]},e.time)})]})},L=e=>{let{chart:t,isLoading:a,onStartGame:r,onBackToMenu:n}=e;return(0,s.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white",children:(0,s.jsxs)("div",{className:"text-center space-y-8 p-8 bg-black/30 rounded-xl backdrop-blur-sm border border-white/10",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent",children:"Ready to Play?"}),a?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full mx-auto"}),(0,s.jsx)("p",{className:"text-lg text-gray-300",children:"Loading chart and audio..."})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("p",{className:"text-lg text-gray-300",children:"Chart loaded and ready!"}),(0,s.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,s.jsx)("button",{onClick:r,className:"px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"Start Game"}),(0,s.jsx)("button",{onClick:n,className:"px-6 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg transition-colors",children:"Back to Menu"})]})]})]})})},M=e=>{let{onResume:t,onRestart:a,onBackToMenu:r}=e;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 p-8 rounded-xl border border-white/20 shadow-2xl",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-center mb-8 bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent",children:"일시정지"}),(0,s.jsxs)("div",{className:"space-y-4 min-w-[200px]",children:[(0,s.jsx)("button",{onClick:t,className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"계속하기"}),(0,s.jsx)("button",{onClick:a,className:"w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"다시시작"}),(0,s.jsx)("button",{onClick:r,className:"w-full px-6 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg font-semibold text-white transition-colors",children:"메뉴로"})]}),(0,s.jsx)("p",{className:"text-center text-gray-400 text-sm mt-6",children:"ESC 키를 눌러 계속하기"})]})})},D=e=>{let{videoPath:t,className:a=""}=e,[n,l]=(0,r.useState)(null),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!1),m=(0,r.useRef)(null);return((0,r.useEffect)(()=>(n&&n.startsWith("blob:")&&URL.revokeObjectURL(n),t)?(i(!0),d(!1),h(!1),window.electron.loadAsset(t).then(e=>{if(e){let t=new Blob([e],{type:"video/mp4"});l(URL.createObjectURL(t)),i(!1)}else throw Error("IPC returned no data for video asset")}).catch(e=>{console.error("Failed to load video asset via IPC:",e),d(!0),i(!1)}),()=>{n&&n.startsWith("blob:")&&URL.revokeObjectURL(n)}):void l(null),[t]),n)?(0,s.jsx)("video",{ref:m,className:"fixed inset-0 w-full h-full object-cover ".concat(a),src:n,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,onLoadStart:()=>{i(!0)},onCanPlay:()=>{i(!1),h(!0),d(!1)},onError:()=>{console.error("Failed to load video: ".concat(n)),i(!1),d(!0)},style:{opacity:+!!u,transition:"opacity 0.5s ease-in-out",zIndex:1}}):(0,s.jsxs)("div",{className:"fixed inset-0 bg-black flex items-center justify-center",style:{zIndex:-1},children:[o&&(0,s.jsx)("div",{className:"text-white",children:"Loading Video..."}),c&&(0,s.jsx)("div",{className:"text-red-500",children:"Error Loading Video"})]})},A=e=>{var t;let{selectedChart:a,onBack:n}=e;console.log("[GameScene] Component rendered with chart:",null==a?void 0:a.title,"gameMode:",null==a?void 0:a.gameMode);let{score:l,combo:o,judgment:i,updateGame:c,togglePause:d,reset:u,isPaused:h}=m(),[x,f]=(0,r.useState)(!1),[g,b]=(0,r.useState)(!1),[p,y]=(0,r.useState)(!0),[v,w]=(0,r.useState)(null),[j,N]=(0,r.useState)(null),[k,O]=(0,r.useState)(null),E=e=>{if(!x||h)return;e&&console.log("[GameScene] Received judgment:",e);let t=S.getCurrentTime();window.electron.handlePinPress(t)};(0,r.useEffect)(()=>{(async()=>{if(!a){console.error("No chart selected, returning to select screen."),n();return}try{if(b(!0),console.log("[Renderer] Loading PinChart:",a),!a||!a.notes||0===a.notes.length){console.error("[Renderer] CRITICAL: Chart data is missing or notes are empty!"),alert("Chart data is invalid. Returning to selection."),n();return}console.log("[Renderer] Chart validation passed - notes count:",a.notes.length),w(a),a.audioFilename&&(await S.loadAudio(a.audioFilename),console.log("[GameScene] Main audio loaded: ".concat(a.audioFilename)));let e=async(e,t)=>{try{let s="".concat(a.folderPath,"/").concat(t);console.log("[HITSOUND DEBUG] Attempting to load sound: ".concat(s," as '").concat(e,"'")),console.log("[HITSOUND DEBUG] selectedChart.folderPath: ".concat(a.folderPath)),a&&a.folderPath?(await S.loadHitsound(e,s),console.log("[HITSOUND DEBUG] Successfully loaded sound: ".concat(s," as '").concat(e,"'"))):(console.error("[HITSOUND DEBUG] Cannot load sound - missing selectedChart or folderPath"),console.error("[HITSOUND DEBUG] selectedChart:",a))}catch(e){console.error("[HITSOUND DEBUG] FAILED to load sound asset: ".concat(t),e)}};if(console.log("[HITSOUND DEBUG] Starting hitsound loading - all optional"),await e("normal-hitnormal","normal-hitnormal.wav"),await e("combobreak","combobreak.wav"),await e("normal-hitwhistle","normal-hitwhistle.wav"),console.log("[HITSOUND DEBUG] Hitsound loading completed - game can proceed without them"),a.videoPath)N(a.videoPath),O(null);else if(a.backgroundPath){N(null);try{let e=await window.electron.loadAsset(a.backgroundPath),t=new Blob([e],{type:"image/jpeg"}),s=URL.createObjectURL(t);O(s)}catch(e){console.error("Failed to load background image:",e),O(null)}}else N(null),O(null);b(!1),console.log("[GameScene] Asset loading completed successfully")}catch(t){console.error("Failed to load game assets:",t),b(!1);let e=t instanceof Error?t.message:"Unknown error";alert("Failed to load game assets: ".concat(e,"\n\nReturning to song selection.")),n()}})()},[a]),(0,r.useEffect)(()=>{let e=window.electron.onGameUpdate(e=>{c(e)});return()=>{e(),S.stop()}},[]),(0,r.useEffect)(()=>{let e=e=>{x&&!h&&"Space"===e.code&&(e.preventDefault(),E())};return x&&!h&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[x,h]),(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.code&&(e.preventDefault(),d())};return x&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[x,d]);let P=()=>{var e;console.log("[GameScene] Starting game with pinChart:",null==v?void 0:v.title,"notes:",null==v||null==(e=v.notes)?void 0:e.length),f(!0),y(!1),v?(window.electron.startGame(v),v.audioFilename&&(console.log("[GameScene] Starting audio playback:",v.audioFilename),S.play())):console.error("[GameScene] Cannot start game - no pinChart available")};return x?h?(0,s.jsx)(M,{onResume:d,onRestart:()=>{u(),d(),P()},onBackToMenu:()=>{u(),d(),n()}}):(0,s.jsxs)("div",{className:"relative w-full h-screen overflow-hidden bg-black",children:[j?(0,s.jsx)(D,{videoPath:j},j):k?(0,s.jsx)("div",{className:"absolute inset-0 z-0 bg-cover bg-center",style:{backgroundImage:"url(".concat(k,")")}}):(0,s.jsx)("div",{className:"absolute inset-0 z-0 bg-gray-900"}),v&&((console.log("[GameScene] Rendering game view. GameMode:",v.gameMode),"pin"===v.gameMode)?(console.log("[GameScene] Rendering PinGameView"),(0,s.jsx)(C,{chart:v,onPinThrow:E,score:l,combo:o,judgment:i,noteSpeed:500})):"osu"===v.gameMode?(console.log("[GameScene] Rendering OsuGameView"),(0,s.jsx)(T,{chart:v})):(console.log("[GameScene] Unsupported gameMode:",v.gameMode),(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsxs)("div",{className:"text-white text-xl",children:["Unsupported game mode: ",v.gameMode]})}))),(0,s.jsxs)("div",{className:"absolute top-4 right-4 bg-black/50 text-white p-2 text-sm z-50 rounded",children:[(0,s.jsxs)("div",{children:["Chart: ",(null==v?void 0:v.title)||"None"]}),(0,s.jsxs)("div",{children:["Mode: ",(null==v?void 0:v.gameMode)||"Unknown"]}),(0,s.jsxs)("div",{children:["Notes: ",(null==v||null==(t=v.notes)?void 0:t.length)||0]}),(0,s.jsxs)("div",{children:["Status: ",x?"Playing":g?"Loading":"Ready"]}),(0,s.jsxs)("div",{children:["Audio: ",S.getCurrentTime().toFixed(2),"s"]})]})]}):(0,s.jsx)("div",{children:(0,s.jsx)(L,{chart:v,isLoading:g,onStartGame:P,onBackToMenu:n})})};var F=a(8723);let R=e=>{let{score:t,maxCombo:a}=e,{rank:r,color:n}=(e=>e>95e4?{rank:"S",color:"text-theme-highlight"}:e>9e5?{rank:"A",color:"text-theme-primary"}:e>8e5?{rank:"B",color:"text-theme-primary/80"}:e>7e5?{rank:"C",color:"text-theme-text-dark"}:{rank:"D",color:"text-theme-accent"})(t);return(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-2xl text-theme-text-dark font-medium mb-2",children:"FINAL SCORE"}),(0,s.jsx)("p",{className:"text-8xl font-black text-transparent bg-gradient-to-r from-theme-primary to-theme-secondary bg-clip-text mb-4",children:t.toLocaleString()}),(0,s.jsxs)("div",{className:"flex justify-center items-baseline gap-8 text-theme-text-light",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-lg text-theme-text-dark",children:"RANK"}),(0,s.jsx)("p",{className:"text-5xl font-bold ".concat(n),children:r})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-lg text-theme-text-dark",children:"MAX COMBO"}),(0,s.jsx)("p",{className:"text-5xl font-bold",children:a})]})]})]})},U={KOOL:"text-theme-highlight",COOL:"text-theme-primary",GOOD:"text-green-400",MISS:"text-theme-accent"},B=e=>{let{judgments:t}=e;return(0,s.jsx)("div",{className:"grid grid-cols-4 gap-4 text-center",children:["KOOL","COOL","GOOD","MISS"].map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-lg ".concat(U[e]," font-bold"),children:e}),(0,s.jsx)("p",{className:"text-3xl font-semibold text-theme-text-light",children:t[e]})]},e))})},z=e=>{let{label:t,onClick:a,variant:r}=e;return(0,s.jsx)("button",{onClick:a,className:"".concat("px-8 py-3 rounded-xl transition-all duration-200 font-medium transform hover:scale-105"," ").concat({primary:"bg-theme-primary/20 hover:bg-theme-primary/30 border border-theme-primary/50 text-theme-primary hover:text-theme-primary/90",secondary:"bg-theme-text-dark/30 hover:bg-theme-text-dark/50 text-theme-text-light/80 hover:text-theme-text-light"}[r]),children:t})},K=e=>{let{onRestart:t,onSelectMusic:a}=e;return(0,s.jsx)("div",{className:"flex justify-center gap-6",children:[{label:"Retry",onClick:t,variant:"primary"},{label:"Back to Menu",onClick:a,variant:"secondary"}].map(e=>(0,s.jsx)(z,{...e},e.label))})},_={S:"text-yellow-400",A:"text-green-400",B:"text-blue-400",C:"text-purple-400",D:"text-gray-500"},H=e=>{let{rank:t}=e,a=_[t]||"text-gray-500";return(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("p",{className:"text-2xl font-semibold text-theme-text-light/80 mb-2",children:"Rank"}),(0,s.jsx)("div",{className:"text-9xl font-black ".concat(a," transform-gpu transition-all duration-500"),style:{filter:"drop-shadow(0 0 20px ".concat(a.replace("text-","bg-").split("-")[0],")")},children:t})]})},Y=e=>{let{accuracy:t}=e,a=2*Math.PI*60,{val:r}=(0,F.zh)({from:{val:0},to:{val:t},config:{duration:1e3}}),{strokeDashoffset:n}=(0,F.zh)({from:{strokeDashoffset:a},to:{strokeDashoffset:a-t/100*a},config:{duration:1e3}});return(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("p",{className:"text-2xl font-semibold text-theme-text-light/80 mb-4",children:"Accuracy"}),(0,s.jsxs)("div",{className:"relative w-40 h-40",children:[(0,s.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 140 140",children:[(0,s.jsx)("circle",{cx:"70",cy:"70",r:60,strokeWidth:"10",className:"stroke-current text-theme-text-dark/30",fill:"transparent"}),(0,s.jsx)(F.CS.circle,{cx:"70",cy:"70",r:60,strokeWidth:"10",className:"stroke-current text-theme-accent transform -rotate-90 origin-center",fill:"transparent",strokeDasharray:a,strokeDashoffset:n,strokeLinecap:"round"})]}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)(F.CS.p,{className:"text-4xl font-bold text-theme-text-light",children:r.to(e=>"".concat(e.toFixed(2),"%"))})})]})]})},V=e=>{let{onBack:t}=e,{score:a,maxCombo:n,judgments:l,reset:o,setCurrentScene:i}=m(),[c,d]=(0,r.useState)(0),[u,h]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=(e=>{let t=e.KOOL+e.COOL+e.GOOD+e.MISS;return 0===t?0:parseFloat(((+e.KOOL+.5*e.COOL+.25*e.GOOD)/t*100).toFixed(2))})(l),t=(e=>e>=98?"S":e>=95?"A":e>=90?"B":e>=80?"C":"D")(e);d(e),h(t)},[l]);let x=()=>{o(),i("Game")},f=()=>{o(),i("Select")},g=[e=>(0,s.jsx)(F.CS.div,{style:e,children:(0,s.jsx)(R,{score:a,maxCombo:n})}),e=>(0,s.jsx)(F.CS.div,{style:e,children:(0,s.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,s.jsx)(F.CS.div,{style:e,children:(0,s.jsxs)("div",{className:"flex justify-around items-center",children:[(0,s.jsx)(H,{rank:u}),(0,s.jsx)(Y,{accuracy:c})]})}),e=>(0,s.jsx)(F.CS.div,{style:e,children:(0,s.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,s.jsx)(F.CS.div,{style:e,children:(0,s.jsx)(B,{judgments:l})}),e=>(0,s.jsx)(F.CS.div,{style:e,children:(0,s.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,s.jsx)(F.CS.div,{style:e,children:(0,s.jsx)(K,{onRestart:x,onSelectMusic:f})})],b=(0,F.pn)(g,{from:{opacity:0,transform:"translateY(20px)"},enter:{opacity:1,transform:"translateY(0px)"},trail:200});return(0,s.jsx)("div",{className:"min-h-screen bg-theme-bg flex items-center justify-center p-8",children:(0,s.jsxs)("div",{className:"bg-theme-bg/70 backdrop-blur-xl rounded-3xl p-12 border border-theme-text-dark/50 shadow-2xl max-w-3xl w-full space-y-8",children:[(0,s.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"Back to Menu"}),(0,s.jsx)("h1",{className:"text-6xl font-black text-center bg-clip-text text-transparent bg-gradient-to-b from-theme-accent to-theme-secondary animate-pulse",children:"GAME CLEAR"}),b((e,t)=>t(e))]})})},W=e=>{let{label:t,value:a,min:r,max:n,step:l,onChange:o}=e;return(0,s.jsxs)("div",{className:"setting-item",children:[(0,s.jsxs)("label",{htmlFor:t,className:"text-2xl font-semibold mb-4 flex justify-between items-center",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"text-3xl font-bold text-theme-secondary bg-theme-bg/50 px-4 py-1 rounded-lg",children:a})]}),(0,s.jsx)("input",{type:"range",id:t,min:r,max:n,step:l,value:a,onChange:o,className:"w-full h-3 bg-theme-text-light/10 rounded-full appearance-none cursor-pointer range-lg accent-theme-accent focus:outline-none focus:ring-2 focus:ring-theme-secondary focus:ring-opacity-50 transition-all duration-300"})]})},X=e=>{let{label:t,value:a}=e;return(0,s.jsxs)("div",{className:"opacity-50",children:[(0,s.jsxs)("label",{className:"text-2xl font-semibold mb-4 flex justify-between items-center",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"text-3xl font-bold text-theme-secondary bg-theme-bg/50 px-4 py-1 rounded-lg",children:a})]}),(0,s.jsx)("input",{type:"range",disabled:!0,className:"w-full h-3 bg-theme-text-light/10 rounded-full appearance-none cursor-not-allowed"}),(0,s.jsx)("p",{className:"text-sm text-right mt-2",children:"Coming Soon"})]})},Z=[{id:"noteSpeed",label:"Note Speed",min:100,max:1e3,step:50,enabled:!0}],q=e=>{let{onBack:t}=e;m(e=>e.setCurrentScene);let[a,n]=(0,r.useState)({});return(0,r.useEffect)(()=>{(async()=>{let e={};for(let t of Z)t.enabled&&(e[t.id]=await window.electron.getSetting(t.id));n(e)})()},[]),(0,s.jsxs)("div",{className:"min-h-screen bg-theme-bg text-theme-text-light flex flex-col items-center justify-center p-8",children:[(0,s.jsx)("div",{className:"absolute top-8 left-8",children:(0,s.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"Back to Menu"})}),(0,s.jsxs)("div",{className:"w-full max-w-2xl bg-theme-bg/70 backdrop-blur-xl rounded-2xl shadow-2xl p-10 border border-theme-text-dark/50",children:[(0,s.jsx)("h1",{className:"text-5xl font-bold text-center mb-12 bg-clip-text text-transparent bg-gradient-to-r from-theme-secondary to-theme-accent animate-pulse",children:"Settings"}),(0,s.jsx)("div",{className:"space-y-10",children:Z.map(e=>{var t,r,l,o,i;return e.enabled?(0,s.jsx)(W,{label:e.label,value:null!=(r=null!=(t=a[e.id])?t:e.min)?r:0,min:null!=(l=e.min)?l:0,max:null!=(o=e.max)?o:100,step:null!=(i=e.step)?i:1,onChange:t=>((e,t)=>{n({...a,[e]:t}),window.electron.setSetting(e,t)})(e.id,parseInt(t.target.value,10))},e.id):(0,s.jsx)(X,{label:e.label,value:100},e.id)})})]}),(0,s.jsx)("p",{className:"mt-8 text-sm text-theme-text-dark",children:"More settings will be available in future updates."})]})},J=e=>{let{onBack:t,onChartSelected:a}=e,[n,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)("");(0,r.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=await window.electron.getChartLibrary();l(e)}catch(e){console.error("Failed to load chart library:",e)}},h=async()=>{try{i(!0),d("파일 선택 중...");let e=await window.electron.selectOszFile();if(!e){d(""),i(!1);return}d("차트 임포트 중..."),await window.electron.importOszFile(e),d("임포트 완료!"),setTimeout(()=>d(""),2e3),await u()}catch(e){console.error("Failed to import .osz file:",e),d("임포트 실패: "+e.message),setTimeout(()=>d(""),3e3)}finally{i(!1)}},m=async(e,t)=>{try{i(!0),d("차트 변환 중...");let s=await window.electron.convertDifficultyToPinChart(e,t);a(s)}catch(e){console.error("Failed to convert difficulty:",e),d("변환 실패: "+e.message),setTimeout(()=>d(""),3e3)}finally{i(!1)}},x=async e=>{if(confirm("이 차트를 삭제하시겠습니까?"))try{await window.electron.invoke("remove-chart-from-library",e),await u()}catch(e){console.error("Failed to remove chart:",e)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-theme-bg-primary text-white p-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-theme-primary mb-2",children:".osz 차트 라이브러리"}),(0,s.jsx)("p",{className:"text-theme-text-secondary",children:"osu! 비트맵(.osz) 파일을 임포트하여 플레이하세요"})]}),(0,s.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"뒤로가기"})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("button",{onClick:h,disabled:o,className:"px-8 py-4 bg-theme-primary text-white rounded-lg hover:bg-theme-primary/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?"처리 중...":".osz 파일 임포트"}),c&&(0,s.jsx)("p",{className:"mt-2 text-theme-accent",children:c})]}),(0,s.jsx)("div",{className:"grid gap-6",children:0===n.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-theme-text-secondary text-lg",children:"임포트된 차트가 없습니다."}),(0,s.jsx)("p",{className:"text-theme-text-secondary mt-2",children:".osz 파일을 임포트하여 시작하세요."})]}):n.map(e=>(0,s.jsxs)("div",{className:"bg-theme-bg-secondary rounded-lg p-6 border border-theme-border",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-theme-primary",children:e.title}),(0,s.jsxs)("p",{className:"text-theme-text-secondary",children:["by ",e.artist," • mapped by ",e.creator]})]}),(0,s.jsx)("button",{onClick:()=>x(e.id),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm",children:"삭제"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.difficulties.map((t,a)=>(0,s.jsxs)("button",{onClick:()=>m(e,a),disabled:o,className:"p-4 bg-theme-bg-primary rounded-lg border border-theme-border hover:border-theme-primary transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",children:[(0,s.jsx)("div",{className:"font-semibold text-theme-primary",children:t.name}),(0,s.jsxs)("div",{className:"text-sm text-theme-text-secondary mt-1",children:["OD: ",t.overallDifficulty.toFixed(1)," • AR: ",t.approachRate.toFixed(1)]}),(0,s.jsxs)("div",{className:"text-sm text-theme-text-secondary",children:[t.noteCount," 노트"]})]},a))})]},e.id))})]})},Q=()=>{let[e,t]=(0,r.useState)("Start"),[a,n]=(0,r.useState)(null),l=e=>{t(e)},o=e=>{n(e),t("Game")};return(0,s.jsx)("div",{children:(()=>{switch(e){case"Start":default:return(0,s.jsx)(i,{onNavigate:l});case"Select":return(0,s.jsx)(f,{onBack:()=>l("Start"),onStartGame:o});case"Game":return a?(0,s.jsx)(A,{selectedChart:a,onBack:()=>l("Select")}):(0,s.jsx)(i,{onNavigate:l});case"Finish":return(0,s.jsx)(V,{onBack:()=>l("Start")});case"Settings":return(0,s.jsx)(q,{onBack:()=>l("Start")});case"OszImport":return(0,s.jsx)(J,{onBack:()=>l("Start"),onChartSelected:o})}})()})};function $(){return(0,s.jsx)(Q,{})}}},e=>{e.O(0,[193,587,18,358],()=>e(e.s=374)),_N_E=e.O()}]);
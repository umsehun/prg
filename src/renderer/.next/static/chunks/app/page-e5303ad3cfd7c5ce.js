(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{374:(e,t,a)=>{Promise.resolve().then(a.bind(a,1587))},1587:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>J});var r=a(4568),s=a(7620);let n=()=>(0,r.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute top-0 left-0 w-72 h-72 bg-theme-secondary rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"}),(0,r.jsx)("div",{className:"absolute top-0 right-0 w-72 h-72 bg-theme-accent rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"}),(0,r.jsx)("div",{className:"absolute bottom-0 left-1/4 w-72 h-72 bg-theme-primary rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"})]}),l=()=>(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-8xl md:text-9xl font-black mb-4 bg-clip-text text-transparent bg-gradient-to-r from-theme-secondary to-theme-accent animate-pulse",children:"PRG"}),(0,r.jsx)("p",{className:"text-xl md:text-2xl text-theme-text-light/80 mb-12 font-light",children:"A RHYTHM GAME EXPERIENCE"})]}),o=[{label:"Start Game",scene:"Select"},{label:".osz Import",scene:"OszImport"},{label:"Settings",scene:"Settings"}],i=e=>{let{onNavigate:t}=e;return(0,r.jsxs)("div",{className:"min-h-screen bg-theme-bg text-theme-text-light flex flex-col items-center justify-center p-8 overflow-hidden relative",children:[(0,r.jsx)(n,{}),(0,r.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center",children:[(0,r.jsx)(l,{}),(0,r.jsx)("div",{className:"space-y-6",children:o.map((e,a)=>(0,r.jsx)("button",{onClick:()=>t(e.scene),className:"group relative px-12 py-4 bg-theme-primary text-theme-text-light rounded-lg hover:bg-theme-primary/80 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:e.label},a))})]})]})};class c{static async loadAudio(e){try{let t=window.electron,a=await t.loadAsset(e),r=new Blob([a],{type:"audio/ogg"});return URL.createObjectURL(r)}catch(t){throw console.error("Failed to load audio asset: ".concat(e),t),Error("Failed to load audio: ".concat(e))}}static async loadImage(e){try{let t=window.electron,a=await t.loadAsset(e),r=new Blob([a],{type:"image/png"});return URL.createObjectURL(r)}catch(t){throw console.error("Failed to load image asset: ".concat(e),t),Error("Failed to load image: ".concat(e))}}static async exists(e){try{let t=window.electron;return await t.assetExists(e)}catch(t){return console.error("Failed to check asset existence: ".concat(e),t),!1}}static cleanup(e){e.startsWith("blob:")&&URL.revokeObjectURL(e)}}let d=e=>{let{bannerPath:t,title:a}=e,[n,l]=(0,s.useState)(null),[o,i]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null);return((0,s.useEffect)(()=>((async()=>{try{i(!0),u(null);let e=t.replace("/assets/",""),a=await c.loadImage(e);l(a)}catch(e){console.error("Failed to load banner image: ".concat(t),e),u("Failed to load image")}finally{i(!1)}})(),()=>{n&&c.cleanup(n)}),[t]),o)?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:(0,r.jsx)("div",{className:"text-white",children:"Loading..."})}):d||!n?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:(0,r.jsx)("div",{className:"text-white/70",children:"No Image"})}):(0,r.jsx)("img",{src:n,alt:a,className:"w-full h-full object-cover"})};var u=a(1620);let h={score:0,combo:0,maxCombo:0,judgment:null,judgments:{KOOL:0,COOL:0,GOOD:0,MISS:0},currentScene:"Start",isPaused:!1,charts:[],selectedChartId:null,gameMode:"pin"},m=(0,u.v)()((e,t)=>({...h,updateGame:a=>{let{combo:r,judgment:s}=a,n={...t().judgments};s&&s in n&&n[s]++,e(e=>({...a,maxCombo:Math.max(e.maxCombo,null!=r?r:e.combo),judgments:n}))},setCurrentScene:t=>e({currentScene:t}),togglePause:()=>e(e=>({isPaused:!e.isPaused})),setSelectedChart:t=>e({selectedChartId:t}),setGameMode:t=>e({gameMode:t}),loadCharts:async()=>{var a,r;if(t().charts.length>0)return;let s=await window.electron.discoverCharts();e({charts:s,selectedChartId:null!=(r=null==(a=s[0])?void 0:a.id)?r:null})},reset:()=>e(h)})),x=()=>(0,r.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-theme-secondary/10 rounded-full blur-3xl animate-pulse"}),(0,r.jsx)("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-theme-primary/10 rounded-full blur-3xl animate-pulse delay-1000"}),(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-theme-accent/5 rounded-full blur-3xl animate-pulse delay-500"})]}),f=e=>{let{onBack:t,onStartGame:a}=e,{charts:n,selectedChartId:l,setSelectedChart:o,setCurrentScene:i,loadCharts:c}=m(),[u,h]=(0,s.useState)(0),[f,g]=(0,s.useState)([]);(0,s.useEffect)(()=>{c()},[]);let b=n.find(e=>e.id===l);(0,s.useEffect)(()=>{if(console.log("[DIFFICULTY DEBUG] Selected chart:",b),console.log("[DIFFICULTY DEBUG] Chart path:",null==b?void 0:b.chartPath),console.log("[DIFFICULTY DEBUG] Full chart object:",JSON.stringify(b,null,2)),b){var e;let t=(null==(e=b.oszMetadata)?void 0:e.difficulties)||b.difficulties;if(console.log("[DIFFICULTY DEBUG] Chart difficulties:",t),t&&t.length>1){let e=t.map(e=>e.name||"Difficulty ".concat(e.index+1));console.log("[DIFFICULTY DEBUG] Setting difficulties:",e),g(e),h(0)}else console.log("[DIFFICULTY DEBUG] No multiple difficulties found, clearing array"),g([]),h(0)}else console.log("[DIFFICULTY DEBUG] No chart selected, clearing difficulties"),g([]),h(0)},[b]);let p=async()=>{if(b)try{let e;(e=b.chartPath.endsWith(".osz")?await window.electron.convertOszToPinChart(b,u):await window.electron.loadPinChart(b.chartPath))&&a(e)}catch(e){console.error("Failed to load chart:",e)}};return(0,r.jsxs)("div",{className:"min-h-screen cyber-bg-animated flex flex-col items-center justify-center p-4 text-white",children:[(0,r.jsx)(x,{}),(0,r.jsxs)("div",{className:"w-full max-w-7xl h-[85vh] game-card flex p-6 z-10 gap-6",children:[(0,r.jsxs)("div",{className:"w-1/3 flex flex-col",children:[(0,r.jsx)("h2",{className:"text-3xl font-black mb-4 neon-glow-cyan",style:{color:"var(--neon-cyan)"},children:"SELECT MUSIC"}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto pr-2 space-y-2 max-h-[calc(85vh-120px)]",children:n.map(e=>(0,r.jsxs)("button",{onClick:()=>o(e.id),className:"w-full text-left p-4 rounded-lg transition-all duration-300 transform hover:scale-102 ".concat(l===e.id?"neon-glow-magenta border-2":"bg-white/10 hover:bg-white/20 border border-transparent hover:border-cyan-400"),style:{backgroundColor:l===e.id?"rgba(255, 0, 255, 0.2)":void 0,borderColor:l===e.id?"var(--neon-magenta)":void 0},children:[(0,r.jsx)("p",{className:"font-bold text-lg truncate",style:{color:l===e.id?"var(--neon-magenta)":"white"},children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-400 truncate",children:e.artist})]},e.id))})]}),(0,r.jsxs)("div",{className:"w-2/3 flex flex-col justify-between",children:[b?(0,r.jsxs)("div",{className:"flex-grow flex flex-col items-center justify-center text-center px-4",children:[(0,r.jsx)("div",{className:"relative w-full max-w-lg h-48 rounded-xl shadow-2xl mb-6 border-2 neon-glow-green overflow-hidden",style:{borderColor:"var(--neon-green)"},children:(0,r.jsx)(d,{bannerPath:b.bannerPath||"",title:b.title})}),(0,r.jsx)("h1",{className:"text-4xl font-extrabold tracking-tight mb-2 neon-glow-pulse",style:{color:"var(--neon-cyan)"},children:b.title}),(0,r.jsx)("p",{className:"text-xl text-gray-300 mb-6",style:{color:"var(--neon-yellow)"},children:b.artist}),f.length>1&&(0,r.jsxs)("div",{className:"w-full max-w-md",children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-4 neon-glow-green",style:{color:"var(--neon-green)"},children:"Select Difficulty"}),(0,r.jsx)("div",{className:"max-h-32 overflow-y-auto space-y-2 p-2 rounded-lg bg-black/20",children:f.map((e,t)=>(0,r.jsx)("button",{onClick:()=>h(t),className:"w-full px-4 py-2 rounded-lg text-left transition-all duration-300 transform hover:scale-105 ".concat(u===t?"neon-glow-yellow font-bold":"bg-white/10 hover:bg-white/20 text-white hover:neon-glow-cyan"),style:{backgroundColor:u===t?"rgba(255, 255, 0, 0.2)":void 0,color:u===t?"var(--neon-yellow)":void 0},children:e},t))})]})]}):(0,r.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-2xl text-gray-400",children:"Select a song to begin"})}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-6",children:[(0,r.jsx)("button",{onClick:t,className:"game-button",style:{borderColor:"var(--neon-red)",boxShadow:"0 0 10px var(--neon-red)"},children:"← Back to Menu"}),(0,r.jsx)("button",{onClick:p,disabled:!b,className:"px-12 py-4 text-2xl font-bold rounded-lg transition-all duration-300 transform ".concat(b?"game-button hover:scale-105 neon-glow-pulse":"bg-gray-600 cursor-not-allowed text-gray-400"),style:b?{borderColor:"var(--neon-green)",boxShadow:"0 0 20px var(--neon-green)",color:"var(--neon-green)"}:{},children:"GAME START"})]})]})]})]})};var g=a(8975);let b={KOOL:{color:"#00ffff",shadow:"0 0 20px #00ffff"},COOL:{color:"#0099ff",shadow:"0 0 15px #0099ff"},GOOD:{color:"#00ff00",shadow:"0 0 10px #00ff00"},MISS:{color:"#ff0000",shadow:"0 0 10px #ff0000"}},p=e=>{let{judgment:t}=e,a=(0,g.pn)(t?[t]:[],{from:{opacity:0,transform:"scale(0.5) translateY(50px)"},enter:{opacity:1,transform:"scale(1) translateY(0px)"},leave:{opacity:0,transform:"scale(0.5) translateY(-50px)"},config:{tension:280,friction:20},keys:e=>"".concat(e,"-").concat(Date.now())});return(0,r.jsx)("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 -translate-y-1/2 z-30 pointer-events-none",children:a((e,t)=>(0,r.jsx)(g.CS.div,{style:e,className:"text-7xl font-black uppercase tracking-widest",children:(0,r.jsx)("span",{style:{color:b[t].color,textShadow:b[t].shadow},children:t})}))})};var y=a(9477);class v{static getInstance(){return v.instance||(v.instance=new v),v.instance}_toArrayBuffer(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array){let t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength&&t.buffer instanceof ArrayBuffer?t.buffer:t.slice().buffer}if(e&&"Buffer"===e.type&&Array.isArray(e.data))return new Uint8Array(e.data).buffer;throw Error("Received invalid data type for audio asset: ".concat(typeof e))}setupGainNodes(){this.audioContext&&(this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.hitsoundGainNode=this.audioContext.createGain(),this.hitsoundGainNode.connect(this.audioContext.destination))}async loadAudio(e){if(!this.audioContext)throw Error("AudioContext not initialized");try{let t=await window.electron.loadAsset(e),a=this._toArrayBuffer(t);this.currentBuffer=await this.audioContext.decodeAudioData(a)}catch(e){throw console.error("Failed to load audio:",e),e}}async loadHitsound(e,t){if(!this.hitsoundBuffers.has(e)&&t)try{console.log("[AudioService] Loading hitsound '".concat(e,"' from: ").concat(t));let a=await fetch(t);if(!a.ok)throw Error("Failed to fetch audio: ".concat(a.status," ").concat(a.statusText));let r=await a.arrayBuffer(),s=await this.audioContext.decodeAudioData(r);this.hitsoundBuffers.set(e,s),console.log("[AudioService] Successfully loaded hitsound '".concat(e,"'"))}catch(a){throw console.error("[AudioService] FAILED to load hitsound ".concat(e," from ").concat(t,":"),a),a}}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.audioContext||!this.currentBuffer||!this.gainNode)return void console.warn("Cannot play: AudioContext, buffer, or gain node not available");this.stop(),this.currentSource=this.audioContext.createBufferSource(),this.currentSource.buffer=this.currentBuffer,this.currentSource.connect(this.gainNode),this.startTime=this.audioContext.currentTime,this.pauseTime=0,this.isPlaying=!0,this.isPaused=!1,this.currentSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this.endedListeners.forEach(e=>e())},this.currentSource.start(0,e)}pause(){this.currentSource&&this.isPlaying&&!this.isPaused&&(this.currentSource.stop(),this.pauseTime=this.getCurrentTime(),this.isPlaying=!1,this.isPaused=!0)}resume(){this.isPaused&&this.pauseTime>0&&this.play(this.pauseTime)}stop(){this.currentSource&&(this.currentSource.stop(),this.currentSource=null),this.isPlaying=!1,this.isPaused=!1,this.startTime=0,this.pauseTime=0}playHitsound(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!this.audioContext||!this.hitsoundGainNode)return;let a=this.hitsoundBuffers.get(e);if(!a)return void console.warn("Hitsound not found: ".concat(e));let r=this.audioContext.createBufferSource(),s=this.audioContext.createGain();r.buffer=a,s.gain.value=t,r.connect(s),s.connect(this.hitsoundGainNode),r.start(),r.onended=()=>{r.disconnect(),s.disconnect()}}getCurrentTime(){return this.audioContext?this.isPaused?this.pauseTime:this.isPlaying&&this.startTime>0?this.audioContext.currentTime-this.startTime:0:0}getDuration(){return this.currentBuffer?this.currentBuffer.duration:0}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.gainNode&&(this.gainNode.gain.value=this.volume)}setHitsoundVolume(e){this.hitsoundGainNode&&(this.hitsoundGainNode.gain.value=Math.max(0,Math.min(1,e)))}getIsPlaying(){return this.isPlaying}getIsPaused(){return this.isPaused}onEnded(e){return this.endedListeners.add(e),()=>this.endedListeners.delete(e)}seekTo(e){this.isPlaying?this.play(e):this.pauseTime=e}constructor(){(0,y._)(this,"audioContext",null),(0,y._)(this,"currentSource",null),(0,y._)(this,"currentBuffer",null),(0,y._)(this,"startTime",0),(0,y._)(this,"pauseTime",0),(0,y._)(this,"isPlaying",!1),(0,y._)(this,"isPaused",!1),(0,y._)(this,"volume",1),(0,y._)(this,"gainNode",null),(0,y._)(this,"hitsoundSources",new Map),(0,y._)(this,"hitsoundBuffers",new Map),(0,y._)(this,"hitsoundGainNode",null),(0,y._)(this,"endedListeners",new Set),this.audioContext=new window.AudioContext,this.setupGainNodes()}}(0,y._)(v,"instance",void 0);let w=v.getInstance(),j=e=>{let{chart:t,onPinThrow:n,score:l,combo:o,judgment:i,noteSpeed:c}=e,[d,u]=(0,s.useState)(!1),[h,m]=(0,s.useState)([]),x=(0,s.useRef)(0),f=(0,s.useRef)(null),g=(0,s.useMemo)(()=>Math.max(400,2e3-c),[c]),{knives:b,throwKnife:y,getKnivesPositions:v,resetKnives:j,stuckKnivesCount:N,setHitCallback:S}=(e=>{let{targetRadius:t,velocity:r=400,rotationSpeed:n=540,isGameActive:l}=e,[o,i]=(0,s.useState)([]),c=(0,s.useRef)(null),d=(0,s.useRef)(0),u=(0,s.useRef)(null);(0,s.useEffect)(()=>{console.log("[useKnifePhysics] Initializing physics worker...");try{let e=new Worker(a.tu(new URL(a.p+a.u(475),a.b)));return c.current=e,console.log("[useKnifePhysics] Worker created, sending INIT message"),e.postMessage({type:"INIT",payload:{targetRadius:t,velocity:r,rotationSpeed:n}}),e.onmessage=e=>{let{type:t,payload:a}=e.data;console.log("[useKnifePhysics] Worker message:",t,a),"UPDATE"===t?i(a.knives):"HIT"===t&&(console.log("[useKnifePhysics] Hit detected at time:",a.hitTime),u.current&&u.current(a.hitTime))},e.onerror=e=>{console.error("[useKnifePhysics] Worker error:",e)},()=>{console.log("[useKnifePhysics] Terminating worker"),e.terminate()}}catch(e){console.error("[useKnifePhysics] Failed to create worker:",e)}},[t,r,n]);let h=(0,s.useCallback)(()=>{if(console.log("[useKnifePhysics] throwKnife called, isGameActive:",l,"worker:",!!c.current),!l||!c.current)return void console.log("[useKnifePhysics] Cannot throw knife - game inactive or no worker");let e={id:d.current++,isStuck:!1,stuckAngle:0,thrownAt:Date.now(),position:{x:0,y:250,rotation:0}};console.log("[useKnifePhysics] Throwing knife:",e),c.current.postMessage({type:"THROW",payload:{knife:e}})},[l]),m=(0,s.useCallback)(()=>o.map(e=>({knife:e,position:e.position})),[o]),x=(0,s.useCallback)(e=>{u.current=e},[]),f=(0,s.useCallback)(()=>{c.current&&c.current.postMessage({type:"RESET"}),i([]),d.current=0},[]),g=o.filter(e=>e.isStuck).length;return{knives:o,throwKnife:h,getKnivesPositions:m,resetKnives:f,stuckKnivesCount:g,setHitCallback:x}})({targetRadius:128,velocity:400,rotationSpeed:540,isGameActive:!0});(0,s.useEffect)(()=>{var e;console.log("[PinGameView] Chart:",null==t?void 0:t.title),console.log("[PinGameView] Knives count:",b.length),console.log("[PinGameView] Approach circles count:",h.length),console.log("[PinGameView] Current time:",x.current),console.log("[PinGameView] Stuck knives count:",N),console.log("[PinGameView] Notes in chart:",(null==t||null==(e=t.notes)?void 0:e.length)||0),console.log("[PinGameView] Audio service time:",w.getCurrentTime())},[t,b.length,h.length,N]),(0,s.useEffect)(()=>{if(!(null==t?void 0:t.notes))return;let e=x.current,a=t.notes.filter(t=>{let a=1e3*t.time-g,r=1e3*t.time+1e3;return e>=a&&e<=r});console.log("[PinGameView] Current time:",e,"Upcoming notes:",a.length),a.length>0&&console.log("[PinGameView] First upcoming note:",a[0])},[t,x.current]),(0,s.useEffect)(()=>{let e,t=()=>{x.current=1e3*w.getCurrentTime(),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>cancelAnimationFrame(e)},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>{let e=1e3*w.getCurrentTime();m(t=>{let a=t.map(t=>({...t,scale:Math.max(.1,1-(e-t.startTime)/g)})).filter(t=>e-t.startTime<g);return a.length!==t.length||a.some((e,a)=>t[a]&&Math.abs(e.scale-t[a].scale)>.01)?a:t})},150);return()=>clearInterval(e)},[g]),(0,s.useEffect)(()=>{if(!(null==t?void 0:t.notes))return void console.log("[PinGameView] No chart or notes available");console.log("[PinGameView] Setting up approach circle generation for",t.notes.length,"notes");let e=setInterval(()=>{let e=x.current,a=t.notes.slice(0,3);console.log("[PinGameView] FORCE DEBUG: Creating circles for first 3 notes at time:",e);let r=a.map((t,a)=>({id:"debug-circle-".concat(t.time,"-").concat(a),noteTime:1e3*t.time,startTime:e,uniqueKey:"debug-".concat(t.time,"-").concat(e,"-").concat(a),scale:1}));m(e=>0===e.length?(console.log("[PinGameView] FORCE DEBUG: Adding",r.length,"debug approach circles"),r):e);let s=t.notes.filter(t=>{let a=1e3*t.time;return a>e&&a<=e+g});s.length>0&&console.log("[PinGameView] Found",s.length,"upcoming notes at time:",e);let n=s.map(t=>({id:"circle-".concat(t.time),noteTime:1e3*t.time,startTime:e,uniqueKey:"".concat(t.time,"-").concat(e),scale:1}));m(e=>{let t=new Set(e.map(e=>e.id)),a=n.filter(e=>!t.has(e.id));return a.length>0?(console.log("[PinGameView] Adding",a.length,"new approach circles"),[...e,...a]):e})},100);return()=>clearInterval(e)},[null==t?void 0:t.notes,g]),(0,s.useEffect)(()=>{S(e=>{n()})},[n,S]),(0,s.useEffect)(()=>{console.log("[PinGameView] Setting up auto knife throwing for debugging");let e=setInterval(()=>{console.log("[PinGameView] FORCE DEBUG: Throwing knife automatically"),y()},2e3);return()=>clearInterval(e)},[y,n]);let C=(0,s.useCallback)(()=>{d||(u(!0),y(),setTimeout(()=>u(!1),150))},[d,y]),k=(0,s.useCallback)(e=>{"KeyS"!==e.code||d||C()},[d,C]);return(0,s.useEffect)(()=>(window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)),[k]),(0,r.jsxs)("div",{className:"min-h-screen relative overflow-hidden flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"absolute top-8 left-8 text-white z-20 bg-black/30 p-4 rounded-xl backdrop-blur-sm border border-white/10 shadow-lg",children:[(0,r.jsxs)("div",{className:"text-3xl font-bold tracking-tighter",children:["Score: ",l]}),(0,r.jsxs)("div",{className:"text-xl mt-1",children:["Combo: ",o]})]}),(0,r.jsxs)("div",{className:"relative w-96 h-96 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-64 h-64 bg-red-500/20 rounded-full border-4 border-red-500 shadow-lg",style:{boxShadow:"0 0 30px rgba(239, 68, 68, 0.5)"}})}),h.map(e=>{let t=Math.min(1,(x.current-e.startTime)/g),a=400-144*t,s=Math.max(.4,1-.6*t);return(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,r.jsx)("div",{className:"rounded-full border-4 border-blue-400",style:{width:"".concat(a,"px"),height:"".concat(a,"px"),opacity:s,boxShadow:"0 0 20px rgba(96, 165, 250, ".concat(.8*s,")"),transition:"none",aspectRatio:"1",flexShrink:0}})},e.uniqueKey)}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-50",children:(0,r.jsx)("div",{className:"rounded-full border-8 border-yellow-400 animate-pulse",style:{width:"300px",height:"300px",opacity:1,boxShadow:"0 0 50px rgba(255, 255, 0, 1.0), inset 0 0 30px rgba(255, 255, 0, 0.3)",backgroundColor:"rgba(255, 255, 0, 0.4)",transform:"scale(1.1)"},children:(0,r.jsx)("div",{className:"absolute inset-4 rounded-full border-4 border-red-500 bg-red-500/20"})})}),(0,r.jsxs)("div",{className:"absolute top-0 left-0 bg-red-500 text-white p-4 z-50 text-lg font-bold",children:["PinGameView is rendering!",(0,r.jsx)("br",{}),"Circles: ",h.length,(0,r.jsx)("br",{}),"Knives: ",b.length,(0,r.jsx)("br",{}),"Time: ",x.current.toFixed(0),"ms"]}),(0,r.jsx)("div",{ref:f,className:"absolute inset-0 flex items-center justify-center z-10 animate-spin",style:{animationDuration:"3s",animationTimingFunction:"linear"},children:(0,r.jsx)("div",{className:"w-8 h-8 bg-gray-600 rounded-full border-2 border-gray-400 shadow-lg"})}),v().map(e=>{let{knife:t,position:a}=e;return(0,r.jsx)("div",{className:"absolute left-1/2 top-1/2 z-20",style:{transform:"translate(-50%, -50%) translate(".concat(a.x,"px, ").concat(a.y,"px) rotate(").concat(a.rotation,"deg)")},children:(0,r.jsxs)("svg",{width:"18",height:"64",viewBox:"0 0 18 64",fill:"none",children:[(0,r.jsx)("path",{d:"M9 2 L16 34 L2 34 Z",fill:"#d1d5db",stroke:"#e5e7eb",strokeWidth:"1"}),(0,r.jsx)("rect",{x:"3",y:"34",width:"12",height:"4",rx:"2",fill:"#9ca3af"}),(0,r.jsx)("rect",{x:"5.5",y:"38",width:"7",height:"18",rx:"2",fill:"#92400e"}),(0,r.jsx)("circle",{cx:"9",cy:"58",r:"4",fill:"#78350f"})]})},t.id)}),(0,r.jsx)("div",{className:"absolute left-1/2 top-1/2 z-20 animate-bounce",style:{transform:"translate(-50%, -50%) translate(0px, 100px) rotate(0deg)",filter:"drop-shadow(0 0 10px rgba(255, 0, 0, 0.8))"},children:(0,r.jsxs)("svg",{width:"24",height:"80",viewBox:"0 0 24 80",fill:"none",children:[(0,r.jsx)("path",{d:"M12 2 L20 40 L4 40 Z",fill:"#ff0000",stroke:"#ffffff",strokeWidth:"2"}),(0,r.jsx)("rect",{x:"4",y:"40",width:"16",height:"6",rx:"3",fill:"#ff0000",stroke:"#ffffff",strokeWidth:"1"}),(0,r.jsx)("rect",{x:"7",y:"46",width:"10",height:"24",rx:"3",fill:"#cc0000",stroke:"#ffffff",strokeWidth:"1"}),(0,r.jsx)("circle",{cx:"12",cy:"72",r:"6",fill:"#990000",stroke:"#ffffff",strokeWidth:"1"})]})}),o>2&&(0,r.jsx)("div",{className:"absolute -bottom-20 text-5xl font-black text-yellow-300 animate-pulse z-30",children:(0,r.jsxs)("span",{style:{textShadow:"0 0 15px rgba(253, 224, 71, 0.8)"},children:[o," COMBO!"]})}),(0,r.jsx)(p,{judgment:i})]})]})};function N(e,t,a){return Math.max(t,Math.min(a,e))}let S=e=>{let{radius:t,scale:a,opacity:s}=e,n=2*t*a;return(0,r.jsx)("div",{className:"absolute rounded-full border-4 border-white/80 pointer-events-none",style:{width:"".concat(n,"px"),height:"".concat(n,"px"),opacity:s,boxShadow:"0 0 16px rgba(255,255,255,0.35)"}})},C=e=>{let{hitErrors:t,maxErrorMs:a}=e,s=t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0;return(0,r.jsxs)("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 w-72 h-4 bg-transparent flex items-center justify-center pointer-events-none",children:[(0,r.jsx)("div",{className:"w-full h-1 bg-black/30 rounded-full overflow-hidden",children:(0,r.jsxs)("div",{className:"absolute w-full h-full flex justify-between items-center",children:[(0,r.jsx)("div",{className:"w-[3px] h-[3px] bg-cyan-400 rounded-full"}),(0,r.jsx)("div",{className:"w-[3px] h-[3px] bg-green-400 rounded-full"}),(0,r.jsx)("div",{className:"w-[3px] h-[3px] bg-yellow-400 rounded-full"})]})}),(0,r.jsx)("div",{className:"absolute w-full h-full",children:t.map((e,s)=>(0,r.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 w-1 h-3 bg-white/80 rounded-full shadow-lg transition-all duration-300 ease-out",style:{left:"".concat(50+e/a*50,"%"),opacity:1-(t.length-1-s)*.1}},s))}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-0.5 bg-cyan-300 shadow-lg"}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-yellow-300 transition-all duration-200 ease-in-out",style:{left:"".concat(50+s/a*50,"%")}})]})},k={KOOL:"#00ffff",COOL:"#88ff88",GOOD:"#ffcc22",MISS:"#ff6666"},E=e=>{let{judgment:t,hitError:a,onAnimationEnd:s}=e,[n,l]=(0,g.zh)(()=>({from:{opacity:0,transform:"scale(0.8) translateY(20px)"},to:{opacity:1,transform:"scale(1) translateY(0px)"},config:{tension:300,friction:15},onRest:()=>{setTimeout(()=>{l.start({to:{opacity:0,transform:"scale(1) translateY(-30px)"},config:{tension:300,friction:20},onRest:s})},400)}})),o="KOOL"===t&&Math.abs(a)>2?a<0?"#88ccff":"#ff8888":k[t];return(0,r.jsx)(g.CS.div,{style:n,className:"absolute text-2xl font-bold uppercase pointer-events-none -translate-x-1/2 -translate-y-1/2",children:(0,r.jsx)("span",{style:{color:o,textShadow:"0 0 8px ".concat(o)},children:t})})},P=e=>{let{onAnimationEnd:t,color:a}=e,[s]=(0,g.wR)(8,e=>({from:{opacity:1,scale:0,x:0,y:0},to:{opacity:0,scale:1.5,x:(Math.random()-.5)*150,y:(Math.random()-.5)*150},config:{mass:1,tension:400,friction:30},onRest:()=>{7===e&&t()}}));return(0,r.jsx)("div",{className:"absolute w-1 h-1",children:s.map((e,t)=>(0,r.jsx)(g.CS.div,{className:"absolute rounded-full",style:{...e,width:"8px",height:"8px",backgroundColor:a,boxShadow:"0 0 10px ".concat(a)}},t))})},O={KOOL:"#00ffff",COOL:"#88ff88",GOOD:"#ffcc22",MISS:"#ff6666"},G=e=>{var t,a,n,l,o;let{chart:i}=e,{score:c,combo:d,judgment:u,isPaused:h,updateGame:x,togglePause:f,reset:g}=m(),[b,p]=(0,s.useState)([]),[y,v]=(0,s.useState)([]),[j,k]=(0,s.useState)([]),[G,T]=(0,s.useState)([]),L=(0,s.useRef)(0),I=(o=null!=(n=null==(t=i.metadata)?void 0:t.approachRate)?n:5)<=5?1800-120*o:1200-150*(o-5),{w300:D}=function(e){return{w300:80-6*e,w100:140-8*e,w50:200-10*e}}(null!=(l=null==(a=i.metadata)?void 0:a.overallDifficulty)?l:5);(0,s.useEffect)(()=>{let e=window.electron.onGameUpdate(e=>{if(e.judgment&&void 0!==e.hitError){let t=F(i.notes.findIndex(t=>t.time===1e3*e.noteTime)%8/8*360,150),a="".concat(Date.now()),r=O[e.judgment]||"#ffffff";if(v(r=>[...r,{id:a,judgment:e.judgment,hitError:e.hitError,x:t.x,y:t.y}]),"MISS"!==e.judgment){k(e=>[...e,{id:a,x:t.x,y:t.y,color:r}]);try{w.playHitsound("normal-hitnormal")}catch(e){}}}void 0!==e.hitError&&p(t=>[...t.slice(-19),e.hitError]),x(e)});return()=>{e()}},[x,i.notes]);let F=(e,t)=>{let a=Math.PI/180*(e-90);return{x:Math.cos(a)*t,y:Math.sin(a)*t}};(0,s.useEffect)(()=>{let e,t=()=>{let a=1e3*w.getCurrentTime();L.current=a,T(i.notes.filter(e=>{let t=1e3*e.time;return a>=t-I&&a<=t+250})),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>cancelAnimationFrame(e)},[i.notes,I]);let A=(0,s.useCallback)(()=>{h||window.electron.handlePinPress(w.getCurrentTime())},[h]);return(0,r.jsxs)("div",{className:"absolute inset-0 cursor-pointer",onClick:A,children:[j.map(e=>(0,r.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(calc(-50% + ".concat(e.x,"px), calc(-50% + ").concat(e.y,"px))")},children:(0,r.jsx)(P,{color:e.color,onAnimationEnd:()=>k(t=>t.filter(t=>t.id!==e.id))})},e.id)),y.map(e=>(0,r.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(calc(-50% + ".concat(e.x,"px), calc(-50% + ").concat(e.y,"px))")},children:(0,r.jsx)(E,{judgment:e.judgment,hitError:e.hitError,onAnimationEnd:()=>v(t=>t.filter(t=>t.id!==e.id)),id:e.id})},e.id)),(0,r.jsx)(C,{hitErrors:b,maxErrorMs:D}),G.map(e=>{let t=1e3*e.time,a=t-I,s=L.current,n=function(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return r+(1-r)*N(1-(t-e)/a,0,1)}(s,t,I,2),l=function(e,t,a){let r=N((e-t)/(.4*a),0,1);return r*r*(3-2*r)}(s,a,I);return(0,r.jsxs)("div",{className:"absolute left-1/2 top-1/2",style:{transform:"translate(-50%, -50%)"},children:[(0,r.jsx)("div",{className:"absolute rounded-full bg-blue-500/50 border-2 border-white shadow",style:{width:"".concat(96,"px"),height:"".concat(96,"px"),opacity:l,boxShadow:"0 0 24px rgba(59,130,246,0.45)"}}),(0,r.jsx)(S,{radius:48,scale:n,opacity:l})]},e.time)})]})},T=e=>{let{chart:t,isLoading:a,onStartGame:s,onBackToMenu:n}=e;return(0,r.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white",children:(0,r.jsxs)("div",{className:"text-center space-y-8 p-8 bg-black/30 rounded-xl backdrop-blur-sm border border-white/10",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent",children:"Ready to Play?"}),a?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full mx-auto"}),(0,r.jsx)("p",{className:"text-lg text-gray-300",children:"Loading chart and audio..."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("p",{className:"text-lg text-gray-300",children:"Chart loaded and ready!"}),(0,r.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,r.jsx)("button",{onClick:s,className:"px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"Start Game"}),(0,r.jsx)("button",{onClick:n,className:"px-6 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg transition-colors",children:"Back to Menu"})]})]})]})})},L=e=>{let{onResume:t,onRestart:a,onBackToMenu:s}=e;return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 p-8 rounded-xl border border-white/20 shadow-2xl",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-center mb-8 bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent",children:"일시정지"}),(0,r.jsxs)("div",{className:"space-y-4 min-w-[200px]",children:[(0,r.jsx)("button",{onClick:t,className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"계속하기"}),(0,r.jsx)("button",{onClick:a,className:"w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"다시시작"}),(0,r.jsx)("button",{onClick:s,className:"w-full px-6 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg font-semibold text-white transition-colors",children:"메뉴로"})]}),(0,r.jsx)("p",{className:"text-center text-gray-400 text-sm mt-6",children:"ESC 키를 눌러 계속하기"})]})})},I=e=>{let{videoPath:t,className:a=""}=e,[n,l]=(0,s.useState)(null),[o,i]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),m=(0,s.useRef)(null);return((0,s.useEffect)(()=>(n&&n.startsWith("blob:")&&URL.revokeObjectURL(n),t)?(i(!0),d(!1),h(!1),window.electron.loadAsset(t).then(e=>{if(e){let t=new Blob([e],{type:"video/mp4"});l(URL.createObjectURL(t)),i(!1)}else throw Error("IPC returned no data for video asset")}).catch(e=>{console.error("Failed to load video asset via IPC:",e),d(!0),i(!1)}),()=>{n&&n.startsWith("blob:")&&URL.revokeObjectURL(n)}):void l(null),[t]),n)?(0,r.jsx)("video",{ref:m,className:"fixed inset-0 w-full h-full object-cover z-0 ".concat(a),src:n,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,onLoadStart:()=>{i(!0)},onCanPlay:()=>{i(!1),h(!0),d(!1)},onError:()=>{console.error("Failed to load video: ".concat(n)),i(!1),d(!0)},style:{opacity:+!!u,transition:"opacity 0.5s ease-in-out"}}):(0,r.jsxs)("div",{className:"fixed inset-0 z-0 bg-black flex items-center justify-center",children:[o&&(0,r.jsx)("div",{className:"text-white",children:"Loading Video..."}),c&&(0,r.jsx)("div",{className:"text-red-500",children:"Error Loading Video"})]})},D=e=>{var t;let{selectedChart:a,onBack:n}=e,{score:l,combo:o,judgment:i,isPaused:c,updateGame:d,togglePause:u,reset:h}=m(),[x,f]=(0,s.useState)(null),[g,b]=(0,s.useState)(!1),[p,y]=(0,s.useState)(!0),[v,N]=(0,s.useState)(null),[S,C]=(0,s.useState)(null),k=async()=>{if(!x||p)return void console.warn("Pin chart or audio not loaded yet. Cannot start game.");console.log("Starting pin game..."),b(!0);try{let e=await window.electron.startGame(x);if(!e.success){console.error("Failed to start game in main process:",e.error),alert("Failed to start game: ".concat(e.error)),b(!1);return}w.play()}catch(e){console.error("Error during game start:",e),alert("Failed to start game: ".concat(e instanceof Error?e.message:"Unknown error")),b(!1)}},E=()=>{if(!g||c)return;let e=w.getCurrentTime();window.electron.handlePinPress(e)};return((0,s.useEffect)(()=>{(async()=>{if(!a){console.error("No chart selected, returning to select screen."),n();return}try{if(y(!0),console.log("[Renderer] Loading PinChart:",a),!a||!a.notes||0===a.notes.length){console.error("[Renderer] CRITICAL: Chart data is missing or notes are empty!"),alert("Chart data is invalid. Returning to selection."),n();return}console.log("[Renderer] Chart validation passed - notes count:",a.notes.length),f(a),a.audioFilename&&(await w.loadAudio(a.audioFilename),console.log("[GameScene] Main audio loaded: ".concat(a.audioFilename)));let e=async(e,t)=>{try{let r="".concat(a.folderPath,"/").concat(t);console.log("[HITSOUND DEBUG] Attempting to load sound: ".concat(r," as '").concat(e,"'")),console.log("[HITSOUND DEBUG] selectedChart.folderPath: ".concat(a.folderPath)),a&&a.folderPath?(await w.loadHitsound(e,r),console.log("[HITSOUND DEBUG] Successfully loaded sound: ".concat(r," as '").concat(e,"'"))):(console.error("[HITSOUND DEBUG] Cannot load sound - missing selectedChart or folderPath"),console.error("[HITSOUND DEBUG] selectedChart:",a))}catch(e){console.error("[HITSOUND DEBUG] FAILED to load sound asset: ".concat(t),e)}};if(console.log("[HITSOUND DEBUG] Starting hitsound loading - all optional"),await e("normal-hitnormal","normal-hitnormal.wav"),await e("combobreak","combobreak.wav"),await e("normal-hitwhistle","normal-hitwhistle.wav"),console.log("[HITSOUND DEBUG] Hitsound loading completed - game can proceed without them"),a.videoPath)N(a.videoPath),C(null);else if(a.backgroundPath){N(null);try{let e=await window.electron.loadAsset(a.backgroundPath),t=new Blob([e],{type:"image/jpeg"}),r=URL.createObjectURL(t);C(r)}catch(e){console.error("Failed to load background image:",e),C(null)}}else N(null),C(null);y(!1),console.log("[GameScene] Asset loading completed successfully")}catch(t){console.error("Failed to load game assets:",t),y(!1);let e=t instanceof Error?t.message:"Unknown error";alert("Failed to load game assets: ".concat(e,"\n\nReturning to song selection.")),n()}})()},[a]),(0,s.useEffect)(()=>{let e=window.electron.onGameUpdate(e=>{d(e)});return()=>{e(),w.stop()}},[]),(0,s.useEffect)(()=>{let e=e=>{g&&!c&&"Space"===e.code&&(e.preventDefault(),E())};return g&&!c&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g,c]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.code&&(e.preventDefault(),u())};return g&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g,u]),g)?c?(0,r.jsx)(L,{onResume:u,onRestart:()=>{h(),u(),k()},onBackToMenu:()=>{h(),u(),n()}}):(0,r.jsxs)("div",{className:"relative w-full h-screen overflow-hidden bg-black",children:[v?(0,r.jsx)(I,{videoPath:v},v):S?(0,r.jsx)("div",{className:"absolute inset-0 z-0 bg-cover bg-center",style:{backgroundImage:"url(".concat(S,")")}}):(0,r.jsx)("div",{className:"absolute inset-0 z-0 bg-gray-900"}),(0,r.jsxs)("div",{className:"absolute top-20 left-4 bg-green-500 text-white p-4 z-50 text-lg font-bold",children:["GameScene Debug:",(0,r.jsx)("br",{}),"pinChart: ",x?"EXISTS":"NULL",(0,r.jsx)("br",{}),"gameMode: ",(null==x?void 0:x.gameMode)||"NONE",(0,r.jsx)("br",{}),"gameStarted: ",g?"YES":"NO"]}),x&&("osu"===x.gameMode?(0,r.jsx)(G,{chart:x}):(0,r.jsxs)("div",{className:"absolute inset-0 bg-blue-500/20",children:[(0,r.jsx)("div",{className:"absolute top-0 left-0 bg-purple-500 text-white p-4 z-50 text-lg font-bold",children:"RENDERING PinGameView!"}),(0,r.jsx)(j,{chart:x,onPinThrow:E,score:l,combo:o,judgment:i,noteSpeed:500})]})),(0,r.jsxs)("div",{className:"absolute top-4 right-4 bg-black/50 text-white p-2 text-sm z-50",children:[(0,r.jsxs)("div",{children:["Chart: ",(null==x?void 0:x.title)||"None"]}),(0,r.jsxs)("div",{children:["Notes: ",(null==x||null==(t=x.notes)?void 0:t.length)||0]}),(0,r.jsxs)("div",{children:["Game Started: ",g?"Yes":"No"]}),(0,r.jsxs)("div",{children:["Loading: ",p?"Yes":"No"]}),(0,r.jsxs)("div",{children:["Audio Time: ",w.getCurrentTime().toFixed(2),"s"]})]})]}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"absolute top-0 left-0 bg-orange-500 text-white p-4 z-50 text-lg font-bold",children:["PRE-GAME STATE - gameStarted: ",g?"YES":"NO"]}),(0,r.jsx)(T,{chart:x,isLoading:p,onStartGame:k,onBackToMenu:n})]})};var F=a(8723);let A=e=>{let{score:t,maxCombo:a}=e,{rank:s,color:n}=(e=>e>95e4?{rank:"S",color:"text-theme-highlight"}:e>9e5?{rank:"A",color:"text-theme-primary"}:e>8e5?{rank:"B",color:"text-theme-primary/80"}:e>7e5?{rank:"C",color:"text-theme-text-dark"}:{rank:"D",color:"text-theme-accent"})(t);return(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-2xl text-theme-text-dark font-medium mb-2",children:"FINAL SCORE"}),(0,r.jsx)("p",{className:"text-8xl font-black text-transparent bg-gradient-to-r from-theme-primary to-theme-secondary bg-clip-text mb-4",children:t.toLocaleString()}),(0,r.jsxs)("div",{className:"flex justify-center items-baseline gap-8 text-theme-text-light",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-lg text-theme-text-dark",children:"RANK"}),(0,r.jsx)("p",{className:"text-5xl font-bold ".concat(n),children:s})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-lg text-theme-text-dark",children:"MAX COMBO"}),(0,r.jsx)("p",{className:"text-5xl font-bold",children:a})]})]})]})},M={KOOL:"text-theme-highlight",COOL:"text-theme-primary",GOOD:"text-green-400",MISS:"text-theme-accent"},B=e=>{let{judgments:t}=e;return(0,r.jsx)("div",{className:"grid grid-cols-4 gap-4 text-center",children:["KOOL","COOL","GOOD","MISS"].map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-lg ".concat(M[e]," font-bold"),children:e}),(0,r.jsx)("p",{className:"text-3xl font-semibold text-theme-text-light",children:t[e]})]},e))})},R=e=>{let{label:t,onClick:a,variant:s}=e;return(0,r.jsx)("button",{onClick:a,className:"".concat("px-8 py-3 rounded-xl transition-all duration-200 font-medium transform hover:scale-105"," ").concat({primary:"bg-theme-primary/20 hover:bg-theme-primary/30 border border-theme-primary/50 text-theme-primary hover:text-theme-primary/90",secondary:"bg-theme-text-dark/30 hover:bg-theme-text-dark/50 text-theme-text-light/80 hover:text-theme-text-light"}[s]),children:t})},U=e=>{let{onRestart:t,onSelectMusic:a}=e;return(0,r.jsx)("div",{className:"flex justify-center gap-6",children:[{label:"Retry",onClick:t,variant:"primary"},{label:"Back to Menu",onClick:a,variant:"secondary"}].map(e=>(0,r.jsx)(R,{...e},e.label))})},z={S:"text-yellow-400",A:"text-green-400",B:"text-blue-400",C:"text-purple-400",D:"text-gray-500"},K=e=>{let{rank:t}=e,a=z[t]||"text-gray-500";return(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("p",{className:"text-2xl font-semibold text-theme-text-light/80 mb-2",children:"Rank"}),(0,r.jsx)("div",{className:"text-9xl font-black ".concat(a," transform-gpu transition-all duration-500"),style:{filter:"drop-shadow(0 0 20px ".concat(a.replace("text-","bg-").split("-")[0],")")},children:t})]})},V=e=>{let{accuracy:t}=e,a=2*Math.PI*60,{val:s}=(0,F.zh)({from:{val:0},to:{val:t},config:{duration:1e3}}),{strokeDashoffset:n}=(0,F.zh)({from:{strokeDashoffset:a},to:{strokeDashoffset:a-t/100*a},config:{duration:1e3}});return(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("p",{className:"text-2xl font-semibold text-theme-text-light/80 mb-4",children:"Accuracy"}),(0,r.jsxs)("div",{className:"relative w-40 h-40",children:[(0,r.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 140 140",children:[(0,r.jsx)("circle",{cx:"70",cy:"70",r:60,strokeWidth:"10",className:"stroke-current text-theme-text-dark/30",fill:"transparent"}),(0,r.jsx)(F.CS.circle,{cx:"70",cy:"70",r:60,strokeWidth:"10",className:"stroke-current text-theme-accent transform -rotate-90 origin-center",fill:"transparent",strokeDasharray:a,strokeDashoffset:n,strokeLinecap:"round"})]}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)(F.CS.p,{className:"text-4xl font-bold text-theme-text-light",children:s.to(e=>"".concat(e.toFixed(2),"%"))})})]})]})},_=e=>{let{onBack:t}=e,{score:a,maxCombo:n,judgments:l,reset:o,setCurrentScene:i}=m(),[c,d]=(0,s.useState)(0),[u,h]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=(e=>{let t=e.KOOL+e.COOL+e.GOOD+e.MISS;return 0===t?0:parseFloat(((+e.KOOL+.5*e.COOL+.25*e.GOOD)/t*100).toFixed(2))})(l),t=(e=>e>=98?"S":e>=95?"A":e>=90?"B":e>=80?"C":"D")(e);d(e),h(t)},[l]);let x=()=>{o(),i("Game")},f=()=>{o(),i("Select")},g=[e=>(0,r.jsx)(F.CS.div,{style:e,children:(0,r.jsx)(A,{score:a,maxCombo:n})}),e=>(0,r.jsx)(F.CS.div,{style:e,children:(0,r.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,r.jsx)(F.CS.div,{style:e,children:(0,r.jsxs)("div",{className:"flex justify-around items-center",children:[(0,r.jsx)(K,{rank:u}),(0,r.jsx)(V,{accuracy:c})]})}),e=>(0,r.jsx)(F.CS.div,{style:e,children:(0,r.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,r.jsx)(F.CS.div,{style:e,children:(0,r.jsx)(B,{judgments:l})}),e=>(0,r.jsx)(F.CS.div,{style:e,children:(0,r.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,r.jsx)(F.CS.div,{style:e,children:(0,r.jsx)(U,{onRestart:x,onSelectMusic:f})})],b=(0,F.pn)(g,{from:{opacity:0,transform:"translateY(20px)"},enter:{opacity:1,transform:"translateY(0px)"},trail:200});return(0,r.jsx)("div",{className:"min-h-screen bg-theme-bg flex items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"bg-theme-bg/70 backdrop-blur-xl rounded-3xl p-12 border border-theme-text-dark/50 shadow-2xl max-w-3xl w-full space-y-8",children:[(0,r.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"Back to Menu"}),(0,r.jsx)("h1",{className:"text-6xl font-black text-center bg-clip-text text-transparent bg-gradient-to-b from-theme-accent to-theme-secondary animate-pulse",children:"GAME CLEAR"}),b((e,t)=>t(e))]})})},H=e=>{let{label:t,value:a,min:s,max:n,step:l,onChange:o}=e;return(0,r.jsxs)("div",{className:"setting-item",children:[(0,r.jsxs)("label",{htmlFor:t,className:"text-2xl font-semibold mb-4 flex justify-between items-center",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{className:"text-3xl font-bold text-theme-secondary bg-theme-bg/50 px-4 py-1 rounded-lg",children:a})]}),(0,r.jsx)("input",{type:"range",id:t,min:s,max:n,step:l,value:a,onChange:o,className:"w-full h-3 bg-theme-text-light/10 rounded-full appearance-none cursor-pointer range-lg accent-theme-accent focus:outline-none focus:ring-2 focus:ring-theme-secondary focus:ring-opacity-50 transition-all duration-300"})]})},Y=e=>{let{label:t,value:a}=e;return(0,r.jsxs)("div",{className:"opacity-50",children:[(0,r.jsxs)("label",{className:"text-2xl font-semibold mb-4 flex justify-between items-center",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{className:"text-3xl font-bold text-theme-secondary bg-theme-bg/50 px-4 py-1 rounded-lg",children:a})]}),(0,r.jsx)("input",{type:"range",disabled:!0,className:"w-full h-3 bg-theme-text-light/10 rounded-full appearance-none cursor-not-allowed"}),(0,r.jsx)("p",{className:"text-sm text-right mt-2",children:"Coming Soon"})]})},W=[{id:"noteSpeed",label:"Note Speed",min:100,max:1e3,step:50,enabled:!0}],q=e=>{let{onBack:t}=e;m(e=>e.setCurrentScene);let[a,n]=(0,s.useState)({});return(0,s.useEffect)(()=>{(async()=>{let e={};for(let t of W)t.enabled&&(e[t.id]=await window.electron.getSetting(t.id));n(e)})()},[]),(0,r.jsxs)("div",{className:"min-h-screen bg-theme-bg text-theme-text-light flex flex-col items-center justify-center p-8",children:[(0,r.jsx)("div",{className:"absolute top-8 left-8",children:(0,r.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"Back to Menu"})}),(0,r.jsxs)("div",{className:"w-full max-w-2xl bg-theme-bg/70 backdrop-blur-xl rounded-2xl shadow-2xl p-10 border border-theme-text-dark/50",children:[(0,r.jsx)("h1",{className:"text-5xl font-bold text-center mb-12 bg-clip-text text-transparent bg-gradient-to-r from-theme-secondary to-theme-accent animate-pulse",children:"Settings"}),(0,r.jsx)("div",{className:"space-y-10",children:W.map(e=>{var t,s,l,o,i;return e.enabled?(0,r.jsx)(H,{label:e.label,value:null!=(s=null!=(t=a[e.id])?t:e.min)?s:0,min:null!=(l=e.min)?l:0,max:null!=(o=e.max)?o:100,step:null!=(i=e.step)?i:1,onChange:t=>((e,t)=>{n({...a,[e]:t}),window.electron.setSetting(e,t)})(e.id,parseInt(t.target.value,10))},e.id):(0,r.jsx)(Y,{label:e.label,value:100},e.id)})})]}),(0,r.jsx)("p",{className:"mt-8 text-sm text-theme-text-dark",children:"More settings will be available in future updates."})]})},X=e=>{let{onBack:t,onChartSelected:a}=e,[n,l]=(0,s.useState)([]),[o,i]=(0,s.useState)(!1),[c,d]=(0,s.useState)("");(0,s.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=await window.electron.getChartLibrary();l(e)}catch(e){console.error("Failed to load chart library:",e)}},h=async()=>{try{i(!0),d("파일 선택 중...");let e=await window.electron.selectOszFile();if(!e){d(""),i(!1);return}d("차트 임포트 중..."),await window.electron.importOszFile(e),d("임포트 완료!"),setTimeout(()=>d(""),2e3),await u()}catch(e){console.error("Failed to import .osz file:",e),d("임포트 실패: "+e.message),setTimeout(()=>d(""),3e3)}finally{i(!1)}},m=async(e,t)=>{try{i(!0),d("차트 변환 중...");let r=await window.electron.convertDifficultyToPinChart(e,t);a(r)}catch(e){console.error("Failed to convert difficulty:",e),d("변환 실패: "+e.message),setTimeout(()=>d(""),3e3)}finally{i(!1)}},x=async e=>{if(confirm("이 차트를 삭제하시겠습니까?"))try{await window.electron.invoke("remove-chart-from-library",e),await u()}catch(e){console.error("Failed to remove chart:",e)}};return(0,r.jsxs)("div",{className:"min-h-screen bg-theme-bg-primary text-white p-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-theme-primary mb-2",children:".osz 차트 라이브러리"}),(0,r.jsx)("p",{className:"text-theme-text-secondary",children:"osu! 비트맵(.osz) 파일을 임포트하여 플레이하세요"})]}),(0,r.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"뒤로가기"})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("button",{onClick:h,disabled:o,className:"px-8 py-4 bg-theme-primary text-white rounded-lg hover:bg-theme-primary/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?"처리 중...":".osz 파일 임포트"}),c&&(0,r.jsx)("p",{className:"mt-2 text-theme-accent",children:c})]}),(0,r.jsx)("div",{className:"grid gap-6",children:0===n.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("p",{className:"text-theme-text-secondary text-lg",children:"임포트된 차트가 없습니다."}),(0,r.jsx)("p",{className:"text-theme-text-secondary mt-2",children:".osz 파일을 임포트하여 시작하세요."})]}):n.map(e=>(0,r.jsxs)("div",{className:"bg-theme-bg-secondary rounded-lg p-6 border border-theme-border",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-theme-primary",children:e.title}),(0,r.jsxs)("p",{className:"text-theme-text-secondary",children:["by ",e.artist," • mapped by ",e.creator]})]}),(0,r.jsx)("button",{onClick:()=>x(e.id),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm",children:"삭제"})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.difficulties.map((t,a)=>(0,r.jsxs)("button",{onClick:()=>m(e,a),disabled:o,className:"p-4 bg-theme-bg-primary rounded-lg border border-theme-border hover:border-theme-primary transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",children:[(0,r.jsx)("div",{className:"font-semibold text-theme-primary",children:t.name}),(0,r.jsxs)("div",{className:"text-sm text-theme-text-secondary mt-1",children:["OD: ",t.overallDifficulty.toFixed(1)," • AR: ",t.approachRate.toFixed(1)]}),(0,r.jsxs)("div",{className:"text-sm text-theme-text-secondary",children:[t.noteCount," 노트"]})]},a))})]},e.id))})]})},Z=()=>{let[e,t]=(0,s.useState)("Start"),[a,n]=(0,s.useState)(null),l=e=>{t(e)},o=e=>{n(e),t("Game")};return(0,r.jsx)("div",{children:(()=>{switch(e){case"Start":default:return(0,r.jsx)(i,{onNavigate:l});case"Select":return(0,r.jsx)(f,{onBack:()=>l("Start"),onStartGame:o});case"Game":return a?(0,r.jsx)(D,{selectedChart:a,onBack:()=>l("Select")}):(0,r.jsx)(i,{onNavigate:l});case"Finish":return(0,r.jsx)(_,{onBack:()=>l("Start")});case"Settings":return(0,r.jsx)(q,{onBack:()=>l("Start")});case"OszImport":return(0,r.jsx)(X,{onBack:()=>l("Start"),onChartSelected:o})}})()})};function J(){return(0,r.jsx)(Z,{})}}},e=>{e.O(0,[710,587,18,358],()=>e(e.s=374)),_N_E=e.O()}]);
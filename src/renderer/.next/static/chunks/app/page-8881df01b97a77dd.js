(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{374:(e,t,r)=>{Promise.resolve().then(r.bind(r,1587))},1587:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>J});var s=r(4568),a=r(7620);let n=()=>(0,s.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 w-72 h-72 bg-theme-secondary rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"}),(0,s.jsx)("div",{className:"absolute top-0 right-0 w-72 h-72 bg-theme-accent rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"}),(0,s.jsx)("div",{className:"absolute bottom-0 left-1/4 w-72 h-72 bg-theme-primary rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"})]}),l=()=>(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-8xl md:text-9xl font-black mb-4 bg-clip-text text-transparent bg-gradient-to-r from-theme-secondary to-theme-accent animate-pulse",children:"PRG"}),(0,s.jsx)("p",{className:"text-xl md:text-2xl text-theme-text-light/80 mb-12 font-light",children:"A RHYTHM GAME EXPERIENCE"})]}),o=[{label:"Start Game",scene:"Select"},{label:".osz Import",scene:"OszImport"},{label:"Settings",scene:"Settings"}],i=e=>{let{onNavigate:t}=e;return(0,s.jsxs)("div",{className:"min-h-screen bg-theme-bg text-theme-text-light flex flex-col items-center justify-center p-8 overflow-hidden relative",children:[(0,s.jsx)(n,{}),(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center justify-center",children:[(0,s.jsx)(l,{}),(0,s.jsx)("div",{className:"space-y-6",children:o.map((e,r)=>(0,s.jsx)("button",{onClick:()=>t(e.scene),className:"group relative px-12 py-4 bg-theme-primary text-theme-text-light rounded-lg hover:bg-theme-primary/80 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:e.label},r))})]})]})};class c{static async loadAudio(e){try{let t=window.electron,r=await t.loadAsset(e),s=new Blob([r],{type:"audio/ogg"});return URL.createObjectURL(s)}catch(t){throw console.error("Failed to load audio asset: ".concat(e),t),Error("Failed to load audio: ".concat(e))}}static async loadImage(e){try{let t=window.electron,r=await t.loadAsset(e),s=new Blob([r],{type:"image/png"});return URL.createObjectURL(s)}catch(t){throw console.error("Failed to load image asset: ".concat(e),t),Error("Failed to load image: ".concat(e))}}static async exists(e){try{let t=window.electron;return await t.assetExists(e)}catch(t){return console.error("Failed to check asset existence: ".concat(e),t),!1}}static cleanup(e){e.startsWith("blob:")&&URL.revokeObjectURL(e)}}let d=e=>{let{bannerPath:t,title:r}=e,[n,l]=(0,a.useState)(null),[o,i]=(0,a.useState)(!0),[d,h]=(0,a.useState)(null);return((0,a.useEffect)(()=>((async()=>{try{i(!0),h(null);let e=t.replace("/assets/",""),r=await c.loadImage(e);l(r)}catch(e){console.error("Failed to load banner image: ".concat(t),e),h("Failed to load image")}finally{i(!1)}})(),()=>{n&&c.cleanup(n)}),[t]),o)?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:(0,s.jsx)("div",{className:"text-white",children:"Loading..."})}):d||!n?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:(0,s.jsx)("div",{className:"text-white/70",children:"No Image"})}):(0,s.jsx)("img",{src:n,alt:r,className:"w-full h-full object-cover"})};var h=r(1620);let u={score:0,combo:0,maxCombo:0,judgment:null,judgments:{KOOL:0,COOL:0,GOOD:0,MISS:0},currentScene:"Start",isPaused:!1,charts:[],selectedChartId:null,gameMode:"pin"},m=(0,h.v)()((e,t)=>({...u,updateGame:r=>{let{combo:s,judgment:a}=r,n={...t().judgments};a&&a in n&&n[a]++,e(e=>({...r,maxCombo:Math.max(e.maxCombo,null!=s?s:e.combo),judgments:n}))},setCurrentScene:t=>e({currentScene:t}),togglePause:()=>e(e=>({isPaused:!e.isPaused})),setSelectedChart:t=>e({selectedChartId:t}),setGameMode:t=>e({gameMode:t}),loadCharts:async()=>{var r,s;if(t().charts.length>0)return;let a=await window.electron.discoverCharts();e({charts:a,selectedChartId:null!=(s=null==(r=a[0])?void 0:r.id)?s:null})},reset:()=>e(u)})),x=()=>(0,s.jsxs)("div",{className:"absolute inset-0 overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-theme-secondary/10 rounded-full blur-3xl animate-pulse"}),(0,s.jsx)("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-theme-primary/10 rounded-full blur-3xl animate-pulse delay-1000"}),(0,s.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-theme-accent/5 rounded-full blur-3xl animate-pulse delay-500"})]}),f=e=>{let{onBack:t,onChartSelected:r}=e,{charts:n,selectedChartId:l,setSelectedChart:o,setCurrentScene:i,loadCharts:c}=m();(0,a.useEffect)(()=>{c()},[]);let h=n.find(e=>e.id===l),u=async()=>{if(h)try{let e;(e=h.chartPath.endsWith(".osz")?await window.electron.convertOszToPinChart(h):await window.electron.loadPinChart(h.chartPath))&&r(e)}catch(e){console.error("Failed to load chart:",e)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-theme-bg flex flex-col items-center justify-center p-8 text-theme-text-light",children:[(0,s.jsx)(x,{}),(0,s.jsxs)("div",{className:"w-full max-w-6xl h-[70vh] bg-black/30 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/10 flex p-8 z-10",children:[(0,s.jsxs)("div",{className:"w-1/3 pr-6 border-r border-white/10 overflow-y-auto",children:[(0,s.jsx)("h2",{className:"text-3xl font-black mb-6 text-theme-accent",children:"SELECT MUSIC"}),(0,s.jsx)("div",{className:"space-y-2",children:n.map(e=>(0,s.jsxs)("button",{onClick:()=>o(e.id),className:"w-full text-left p-4 rounded-lg transition-all duration-200 ".concat(l===e.id?"bg-theme-primary/30 border-l-4 border-theme-primary":"bg-white/5 hover:bg-white/10"),children:[(0,s.jsx)("p",{className:"font-bold text-lg",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-white/60",children:e.artist})]},e.id))})]}),(0,s.jsxs)("div",{className:"w-2/3 pl-8 flex flex-col justify-between",children:[h?(0,s.jsxs)("div",{className:"flex-grow flex flex-col items-center justify-center text-center",children:[(0,s.jsx)("div",{className:"relative w-full max-w-lg h-48 rounded-lg shadow-lg mb-8 border-2 border-white/20 overflow-hidden",children:(0,s.jsx)(d,{bannerPath:h.bannerPath||"",title:h.title})}),(0,s.jsx)("h1",{className:"text-5xl font-extrabold tracking-tight",children:h.title}),(0,s.jsx)("p",{className:"text-2xl text-white/70 mt-2",children:h.artist})]}):(0,s.jsx)("div",{className:"flex-grow flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-2xl",children:"Select a song"})}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"Back to Menu"}),(0,s.jsx)("button",{onClick:u,disabled:!h,className:"px-12 py-4 text-2xl font-bold bg-theme-accent rounded-lg hover:bg-opacity-80 transition-all disabled:bg-gray-600 disabled:cursor-not-allowed transform hover:scale-105",children:"GAME START"})]})]})]})]})};var g=r(8975);let b={KOOL:{color:"#00ffff",shadow:"0 0 20px #00ffff"},COOL:{color:"#0099ff",shadow:"0 0 15px #0099ff"},GOOD:{color:"#00ff00",shadow:"0 0 10px #00ff00"},MISS:{color:"#ff0000",shadow:"0 0 10px #ff0000"}},p=e=>{let{judgment:t}=e,r=(0,g.pn)(t?[t]:[],{from:{opacity:0,transform:"scale(0.5) translateY(50px)"},enter:{opacity:1,transform:"scale(1) translateY(0px)"},leave:{opacity:0,transform:"scale(0.5) translateY(-50px)"},config:{tension:280,friction:20},keys:e=>"".concat(e,"-").concat(Date.now())});return(0,s.jsx)("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 -translate-y-1/2 z-30 pointer-events-none",children:r((e,t)=>(0,s.jsx)(g.CS.div,{style:e,className:"text-7xl font-black uppercase tracking-widest",children:(0,s.jsx)("span",{style:{color:b[t].color,textShadow:b[t].shadow},children:t})}))})};var y=r(9477);class w{static getInstance(){return w.instance||(w.instance=new w),w.instance}_toArrayBuffer(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array)return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(e&&"Buffer"===e.type&&Array.isArray(e.data))return new Uint8Array(e.data).buffer;throw Error("Received invalid data type for audio asset: ".concat(typeof e))}setupGainNodes(){this.audioContext&&(this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.hitsoundGainNode=this.audioContext.createGain(),this.hitsoundGainNode.connect(this.audioContext.destination))}async loadAudio(e){if(!this.audioContext)throw Error("AudioContext not initialized");try{let t=await window.electron.loadAsset(e),r=this._toArrayBuffer(t);this.currentBuffer=await this.audioContext.decodeAudioData(r)}catch(e){throw console.error("Failed to load audio:",e),e}}async loadHitsound(e,t){if(!this.audioContext)throw Error("AudioContext not initialized");try{let r=await window.electron.loadAsset(t),s=this._toArrayBuffer(r),a=await this.audioContext.decodeAudioData(s);this.hitsoundBuffers.set(e,a)}catch(t){throw console.error("Failed to load hitsound ".concat(e,":"),t),t}}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.audioContext||!this.currentBuffer||!this.gainNode)return void console.warn("Cannot play: AudioContext, buffer, or gain node not available");this.stop(),this.currentSource=this.audioContext.createBufferSource(),this.currentSource.buffer=this.currentBuffer,this.currentSource.connect(this.gainNode),this.startTime=this.audioContext.currentTime,this.pauseTime=0,this.isPlaying=!0,this.isPaused=!1,this.currentSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this.endedListeners.forEach(e=>e())},this.currentSource.start(0,e)}pause(){this.currentSource&&this.isPlaying&&!this.isPaused&&(this.currentSource.stop(),this.pauseTime=this.getCurrentTime(),this.isPlaying=!1,this.isPaused=!0)}resume(){this.isPaused&&this.pauseTime>0&&this.play(this.pauseTime)}stop(){this.currentSource&&(this.currentSource.stop(),this.currentSource=null),this.isPlaying=!1,this.isPaused=!1,this.startTime=0,this.pauseTime=0}playHitsound(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!this.audioContext||!this.hitsoundGainNode)return;let r=this.hitsoundBuffers.get(e);if(!r)return void console.warn("Hitsound not found: ".concat(e));let s=this.audioContext.createBufferSource(),a=this.audioContext.createGain();s.buffer=r,a.gain.value=t,s.connect(a),a.connect(this.hitsoundGainNode),s.start(),s.onended=()=>{s.disconnect(),a.disconnect()}}getCurrentTime(){return this.audioContext?this.isPaused?this.pauseTime:this.isPlaying&&this.startTime>0?this.audioContext.currentTime-this.startTime:0:0}getDuration(){return this.currentBuffer?this.currentBuffer.duration:0}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.gainNode&&(this.gainNode.gain.value=this.volume)}setHitsoundVolume(e){this.hitsoundGainNode&&(this.hitsoundGainNode.gain.value=Math.max(0,Math.min(1,e)))}getIsPlaying(){return this.isPlaying}getIsPaused(){return this.isPaused}onEnded(e){return this.endedListeners.add(e),()=>this.endedListeners.delete(e)}seekTo(e){this.isPlaying?this.play(e):this.pauseTime=e}constructor(){(0,y._)(this,"audioContext",null),(0,y._)(this,"currentSource",null),(0,y._)(this,"currentBuffer",null),(0,y._)(this,"startTime",0),(0,y._)(this,"pauseTime",0),(0,y._)(this,"isPlaying",!1),(0,y._)(this,"isPaused",!1),(0,y._)(this,"volume",1),(0,y._)(this,"gainNode",null),(0,y._)(this,"hitsoundSources",new Map),(0,y._)(this,"hitsoundBuffers",new Map),(0,y._)(this,"hitsoundGainNode",null),(0,y._)(this,"endedListeners",new Set),this.audioContext=new window.AudioContext,this.setupGainNodes()}}(0,y._)(w,"instance",void 0);let v=w.getInstance(),j=e=>{let{chart:t,onPinThrow:n,score:l,combo:o,judgment:i,noteSpeed:c}=e,[d,h]=(0,a.useState)(!1),[u,m]=(0,a.useState)([]),x=(0,a.useRef)(0),f=(0,a.useRef)(null),g=(0,a.useMemo)(()=>Math.max(400,2e3-c),[c]),{knives:b,throwKnife:y,getKnivesPositions:w,resetKnives:j,stuckKnivesCount:N,setHitCallback:k}=(e=>{let{targetRadius:t,velocity:s=400,rotationSpeed:n=540,isGameActive:l}=e,[o,i]=(0,a.useState)([]),c=(0,a.useRef)(null),d=(0,a.useRef)(0),h=(0,a.useRef)(null);(0,a.useEffect)(()=>{console.log("[useKnifePhysics] Initializing physics worker...");try{let e=new Worker(r.tu(new URL(r.p+r.u(475),r.b)));return c.current=e,console.log("[useKnifePhysics] Worker created, sending INIT message"),e.postMessage({type:"INIT",payload:{targetRadius:t,velocity:s,rotationSpeed:n}}),e.onmessage=e=>{let{type:t,payload:r}=e.data;console.log("[useKnifePhysics] Worker message:",t,r),"UPDATE"===t?i(r.knives):"HIT"===t&&(console.log("[useKnifePhysics] Hit detected at time:",r.hitTime),h.current&&h.current(r.hitTime))},e.onerror=e=>{console.error("[useKnifePhysics] Worker error:",e)},()=>{console.log("[useKnifePhysics] Terminating worker"),e.terminate()}}catch(e){console.error("[useKnifePhysics] Failed to create worker:",e)}},[t,s,n]);let u=(0,a.useCallback)(()=>{if(console.log("[useKnifePhysics] throwKnife called, isGameActive:",l,"worker:",!!c.current),!l||!c.current)return void console.log("[useKnifePhysics] Cannot throw knife - game inactive or no worker");let e={id:d.current++,isStuck:!1,stuckAngle:0,thrownAt:Date.now(),position:{x:0,y:250,rotation:0}};console.log("[useKnifePhysics] Throwing knife:",e),c.current.postMessage({type:"THROW",payload:{knife:e}})},[l]),m=(0,a.useCallback)(()=>o.map(e=>({knife:e,position:e.position})),[o]),x=(0,a.useCallback)(e=>{h.current=e},[]),f=(0,a.useCallback)(()=>{c.current&&c.current.postMessage({type:"RESET"}),i([]),d.current=0},[]),g=o.filter(e=>e.isStuck).length;return{knives:o,throwKnife:u,getKnivesPositions:m,resetKnives:f,stuckKnivesCount:g,setHitCallback:x}})({targetRadius:128,velocity:400,rotationSpeed:540,isGameActive:!0});(0,a.useEffect)(()=>{var e;console.log("[PinGameView] Chart:",null==t?void 0:t.title),console.log("[PinGameView] Knives count:",b.length),console.log("[PinGameView] Approach circles count:",u.length),console.log("[PinGameView] Current time:",x.current),console.log("[PinGameView] Stuck knives count:",N),console.log("[PinGameView] Notes in chart:",(null==t||null==(e=t.notes)?void 0:e.length)||0),console.log("[PinGameView] Audio service time:",v.getCurrentTime())},[t,b.length,u.length,N]),(0,a.useEffect)(()=>{if(!(null==t?void 0:t.notes))return;let e=x.current,r=t.notes.filter(t=>{let r=1e3*t.time-g,s=1e3*t.time+1e3;return e>=r&&e<=s});console.log("[PinGameView] Current time:",e,"Upcoming notes:",r.length),r.length>0&&console.log("[PinGameView] First upcoming note:",r[0])},[t,x.current]),(0,a.useEffect)(()=>{let e,t=()=>{x.current=1e3*v.getCurrentTime(),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>cancelAnimationFrame(e)},[]),(0,a.useEffect)(()=>{let e=setInterval(()=>{let e=1e3*v.getCurrentTime();m(t=>{let r=t.map(t=>({...t,scale:Math.max(.1,1-(e-t.startTime)/g)})).filter(t=>e-t.startTime<g);return r.length!==t.length||r.some((e,r)=>t[r]&&Math.abs(e.scale-t[r].scale)>.01)?r:t})},150);return()=>clearInterval(e)},[g]),(0,a.useEffect)(()=>{if(!(null==t?void 0:t.notes))return;let e=x.current,r=t.notes.filter(t=>{let r=1e3*t.time;return r>e&&r<=e+g}).map(t=>({id:"circle-".concat(t.time),noteTime:1e3*t.time,startTime:e,uniqueKey:"".concat(t.time,"-").concat(e),scale:1}));m(e=>{let t=new Set(e.map(e=>e.id));return[...e,...r.filter(e=>!t.has(e.id))]})},[null==t?void 0:t.notes]),(0,a.useEffect)(()=>{k(e=>{n()})},[k,n]);let C=(0,a.useCallback)(()=>{d||(h(!0),y(),setTimeout(()=>h(!1),150))},[d,y]),S=(0,a.useCallback)(e=>{"KeyS"!==e.code||d||C()},[d,C]);return(0,a.useEffect)(()=>(window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)),[S]),(0,s.jsxs)("div",{className:"min-h-screen relative overflow-hidden flex flex-col items-center justify-center",children:[(0,s.jsxs)("div",{className:"absolute top-8 left-8 text-white z-20 bg-black/30 p-4 rounded-xl backdrop-blur-sm border border-white/10 shadow-lg",children:[(0,s.jsxs)("div",{className:"text-3xl font-bold tracking-tighter",children:["Score: ",l]}),(0,s.jsxs)("div",{className:"text-xl mt-1",children:["Combo: ",o]})]}),(0,s.jsxs)("div",{className:"relative w-96 h-96 flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-64 h-64 bg-red-500/20 rounded-full border-4 border-red-500 shadow-lg",style:{boxShadow:"0 0 30px rgba(239, 68, 68, 0.5)"}})}),u.map(e=>{let t=Math.min(1,(x.current-e.startTime)/g),r=400-144*t,a=Math.max(.4,1-.6*t);return(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,s.jsx)("div",{className:"rounded-full border-4 border-blue-400",style:{width:"".concat(r,"px"),height:"".concat(r,"px"),opacity:a,boxShadow:"0 0 20px rgba(96, 165, 250, ".concat(.8*a,")"),transition:"none",aspectRatio:"1",flexShrink:0}})},e.uniqueKey)}),(0,s.jsx)("div",{ref:f,className:"absolute inset-0 flex items-center justify-center z-10 animate-spin",style:{animationDuration:"3s",animationTimingFunction:"linear"},children:(0,s.jsx)("div",{className:"w-8 h-8 bg-gray-600 rounded-full border-2 border-gray-400 shadow-lg"})}),w().map(e=>{let{knife:t,position:r}=e;return(0,s.jsx)("div",{className:"absolute left-1/2 top-1/2 z-20",style:{transform:"translate(-50%, -50%) translate(".concat(r.x,"px, ").concat(r.y,"px) rotate(").concat(r.rotation,"deg)")},children:(0,s.jsxs)("svg",{width:"18",height:"64",viewBox:"0 0 18 64",fill:"none",children:[(0,s.jsx)("path",{d:"M9 2 L16 34 L2 34 Z",fill:"#d1d5db",stroke:"#e5e7eb",strokeWidth:"1"}),(0,s.jsx)("rect",{x:"3",y:"34",width:"12",height:"4",rx:"2",fill:"#9ca3af"}),(0,s.jsx)("rect",{x:"5.5",y:"38",width:"7",height:"18",rx:"2",fill:"#92400e"}),(0,s.jsx)("circle",{cx:"9",cy:"58",r:"4",fill:"#78350f"})]})},t.id)}),o>2&&(0,s.jsx)("div",{className:"absolute -bottom-20 text-5xl font-black text-yellow-300 animate-pulse z-30",children:(0,s.jsxs)("span",{style:{textShadow:"0 0 15px rgba(253, 224, 71, 0.8)"},children:[o," COMBO!"]})}),(0,s.jsx)(p,{judgment:i})]})]})};function N(e,t,r){return Math.max(t,Math.min(r,e))}let k=e=>{let{radius:t,scale:r,opacity:a}=e,n=2*t*r;return(0,s.jsx)("div",{className:"absolute rounded-full border-4 border-white/80 pointer-events-none",style:{width:"".concat(n,"px"),height:"".concat(n,"px"),opacity:a,boxShadow:"0 0 16px rgba(255,255,255,0.35)"}})},C=e=>{let{hitErrors:t,maxErrorMs:r}=e,a=t.length>0?t.reduce((e,t)=>e+t,0)/t.length:0;return(0,s.jsxs)("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 w-72 h-4 bg-transparent flex items-center justify-center pointer-events-none",children:[(0,s.jsx)("div",{className:"w-full h-1 bg-black/30 rounded-full overflow-hidden",children:(0,s.jsxs)("div",{className:"absolute w-full h-full flex justify-between items-center",children:[(0,s.jsx)("div",{className:"w-[3px] h-[3px] bg-cyan-400 rounded-full"}),(0,s.jsx)("div",{className:"w-[3px] h-[3px] bg-green-400 rounded-full"}),(0,s.jsx)("div",{className:"w-[3px] h-[3px] bg-yellow-400 rounded-full"})]})}),(0,s.jsx)("div",{className:"absolute w-full h-full",children:t.map((e,a)=>(0,s.jsx)("div",{className:"absolute top-1/2 -translate-y-1/2 w-1 h-3 bg-white/80 rounded-full shadow-lg transition-all duration-300 ease-out",style:{left:"".concat(50+e/r*50,"%"),opacity:1-(t.length-1-a)*.1}},a))}),(0,s.jsx)("div",{className:"absolute top-0 bottom-0 left-1/2 -translate-x-1/2 w-0.5 bg-cyan-300 shadow-lg"}),(0,s.jsx)("div",{className:"absolute top-0 bottom-0 w-0.5 bg-yellow-300 transition-all duration-200 ease-in-out",style:{left:"".concat(50+a/r*50,"%")}})]})},S={KOOL:"#00ffff",COOL:"#88ff88",GOOD:"#ffcc22",MISS:"#ff6666"},P=e=>{let{judgment:t,hitError:r,onAnimationEnd:a}=e,[n,l]=(0,g.zh)(()=>({from:{opacity:0,transform:"scale(0.8) translateY(20px)"},to:{opacity:1,transform:"scale(1) translateY(0px)"},config:{tension:300,friction:15},onRest:()=>{setTimeout(()=>{l.start({to:{opacity:0,transform:"scale(1) translateY(-30px)"},config:{tension:300,friction:20},onRest:a})},400)}})),o="KOOL"===t&&Math.abs(r)>2?r<0?"#88ccff":"#ff8888":S[t];return(0,s.jsx)(g.CS.div,{style:n,className:"absolute text-2xl font-bold uppercase pointer-events-none -translate-x-1/2 -translate-y-1/2",children:(0,s.jsx)("span",{style:{color:o,textShadow:"0 0 8px ".concat(o)},children:t})})},E=e=>{let{onAnimationEnd:t,color:r}=e,[a]=(0,g.wR)(8,e=>({from:{opacity:1,scale:0,x:0,y:0},to:{opacity:0,scale:1.5,x:(Math.random()-.5)*150,y:(Math.random()-.5)*150},config:{mass:1,tension:400,friction:30},onRest:()=>{7===e&&t()}}));return(0,s.jsx)("div",{className:"absolute w-1 h-1",children:a.map((e,t)=>(0,s.jsx)(g.CS.div,{className:"absolute rounded-full",style:{...e,width:"8px",height:"8px",backgroundColor:r,boxShadow:"0 0 10px ".concat(r)}},t))})},O={KOOL:"#00ffff",COOL:"#88ff88",GOOD:"#ffcc22",MISS:"#ff6666"},L=e=>{var t,r,n,l,o;let{chart:i}=e,{score:c,combo:d,judgment:h,isPaused:u,updateGame:x,togglePause:f,reset:g}=m(),[b,p]=(0,a.useState)([]),[y,w]=(0,a.useState)([]),[j,S]=(0,a.useState)([]),[L,T]=(0,a.useState)([]),A=(0,a.useRef)(0),M=(o=null!=(n=null==(t=i.metadata)?void 0:t.approachRate)?n:5)<=5?1800-120*o:1200-150*(o-5),{w300:R}=function(e){return{w300:80-6*e,w100:140-8*e,w50:200-10*e}}(null!=(l=null==(r=i.metadata)?void 0:r.overallDifficulty)?l:5);(0,a.useEffect)(()=>{let e=window.electron.onGameUpdate(e=>{if(e.judgment&&void 0!==e.hitError){let t=G(i.notes.findIndex(t=>t.time===1e3*e.noteTime)%8/8*360,150),r="".concat(Date.now()),s=O[e.judgment]||"#ffffff";if(w(s=>[...s,{id:r,judgment:e.judgment,hitError:e.hitError,x:t.x,y:t.y}]),"MISS"!==e.judgment){S(e=>[...e,{id:r,x:t.x,y:t.y,color:s}]);try{v.playHitsound("normal-hitnormal")}catch(e){}}}void 0!==e.hitError&&p(t=>[...t.slice(-19),e.hitError]),x(e)});return()=>{e()}},[x,i.notes]);let G=(e,t)=>{let r=Math.PI/180*(e-90);return{x:Math.cos(r)*t,y:Math.sin(r)*t}};(0,a.useEffect)(()=>{let e,t=()=>{let r=1e3*v.getCurrentTime();A.current=r,T(i.notes.filter(e=>{let t=1e3*e.time;return r>=t-M&&r<=t+250})),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>cancelAnimationFrame(e)},[i.notes,M]);let F=(0,a.useCallback)(()=>{u||window.electron.handlePinPress(v.getCurrentTime())},[u]);return(0,s.jsxs)("div",{className:"absolute inset-0 cursor-pointer",onClick:F,children:[j.map(e=>(0,s.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(calc(-50% + ".concat(e.x,"px), calc(-50% + ").concat(e.y,"px))")},children:(0,s.jsx)(E,{color:e.color,onAnimationEnd:()=>S(t=>t.filter(t=>t.id!==e.id))})},e.id)),y.map(e=>(0,s.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(calc(-50% + ".concat(e.x,"px), calc(-50% + ").concat(e.y,"px))")},children:(0,s.jsx)(P,{judgment:e.judgment,hitError:e.hitError,onAnimationEnd:()=>w(t=>t.filter(t=>t.id!==e.id)),id:e.id})},e.id)),(0,s.jsx)(C,{hitErrors:b,maxErrorMs:R}),L.map(e=>{let t=1e3*e.time,r=t-M,a=A.current,n=function(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return s+(1-s)*N(1-(t-e)/r,0,1)}(a,t,M,2),l=function(e,t,r){let s=N((e-t)/(.4*r),0,1);return s*s*(3-2*s)}(a,r,M);return(0,s.jsxs)("div",{className:"absolute left-1/2 top-1/2",style:{transform:"translate(-50%, -50%)"},children:[(0,s.jsx)("div",{className:"absolute rounded-full bg-blue-500/50 border-2 border-white shadow",style:{width:"".concat(96,"px"),height:"".concat(96,"px"),opacity:l,boxShadow:"0 0 24px rgba(59,130,246,0.45)"}}),(0,s.jsx)(k,{radius:48,scale:n,opacity:l})]},e.time)})]})},T=e=>{let{chart:t,isLoading:r,onStartGame:a,onBackToMenu:n}=e;return(0,s.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white",children:(0,s.jsxs)("div",{className:"text-center space-y-8 p-8 bg-black/30 rounded-xl backdrop-blur-sm border border-white/10",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent",children:"Ready to Play?"}),r?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full mx-auto"}),(0,s.jsx)("p",{className:"text-lg text-gray-300",children:"Loading chart and audio..."})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("p",{className:"text-lg text-gray-300",children:"Chart loaded and ready!"}),(0,s.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,s.jsx)("button",{onClick:a,className:"px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"Start Game"}),(0,s.jsx)("button",{onClick:n,className:"px-6 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg transition-colors",children:"Back to Menu"})]})]})]})})},A=e=>{let{onResume:t,onRestart:r,onBackToMenu:a}=e;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-gradient-to-br from-gray-900 to-gray-800 p-8 rounded-xl border border-white/20 shadow-2xl",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-center mb-8 bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent",children:"일시정지"}),(0,s.jsxs)("div",{className:"space-y-4 min-w-[200px]",children:[(0,s.jsx)("button",{onClick:t,className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"계속하기"}),(0,s.jsx)("button",{onClick:r,className:"w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 rounded-lg font-semibold text-white transition-all duration-200 transform hover:scale-105 shadow-lg",children:"다시시작"}),(0,s.jsx)("button",{onClick:a,className:"w-full px-6 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg font-semibold text-white transition-colors",children:"메뉴로"})]}),(0,s.jsx)("p",{className:"text-center text-gray-400 text-sm mt-6",children:"ESC 키를 눌러 계속하기"})]})})},M=e=>{let{videoPath:t,className:r=""}=e,[n,l]=(0,a.useState)(null),[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),[h,u]=(0,a.useState)(!1),m=(0,a.useRef)(null);return((0,a.useEffect)(()=>(n&&n.startsWith("blob:")&&URL.revokeObjectURL(n),t)?(i(!0),d(!1),u(!1),window.electron.loadAsset(t).then(e=>{if(e){let t=new Blob([e],{type:"video/mp4"});l(URL.createObjectURL(t)),i(!1)}else throw Error("IPC returned no data for video asset")}).catch(e=>{console.error("Failed to load video asset via IPC:",e),d(!0),i(!1)}),()=>{n&&n.startsWith("blob:")&&URL.revokeObjectURL(n)}):void l(null),[t]),n)?(0,s.jsx)("video",{ref:m,className:"fixed inset-0 w-full h-full object-cover z-0 ".concat(r),src:n,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,onLoadStart:()=>{i(!0)},onCanPlay:()=>{i(!1),u(!0),d(!1)},onError:()=>{console.error("Failed to load video: ".concat(n)),i(!1),d(!0)},style:{opacity:+!!h,transition:"opacity 0.5s ease-in-out"}}):(0,s.jsxs)("div",{className:"fixed inset-0 z-0 bg-black flex items-center justify-center",children:[o&&(0,s.jsx)("div",{className:"text-white",children:"Loading Video..."}),c&&(0,s.jsx)("div",{className:"text-red-500",children:"Error Loading Video"})]})},R=e=>{var t;let{selectedChart:r,onBack:n}=e,{score:l,combo:o,judgment:i,isPaused:c,updateGame:d,togglePause:h,reset:u}=m(),[x,f]=(0,a.useState)(null),[g,b]=(0,a.useState)(!1),[p,y]=(0,a.useState)(!0),[w,N]=(0,a.useState)(null),[k,C]=(0,a.useState)(null),S=async()=>{if(!x||p)return void console.warn("Pin chart or audio not loaded yet. Cannot start game.");console.log("Starting pin game..."),b(!0);try{let e=await window.electron.startGame(x);if(!e.success){console.error("Failed to start game in main process:",e.error),alert("Failed to start game: ".concat(e.error)),b(!1);return}v.play()}catch(e){console.error("Error during game start:",e),alert("Failed to start game: ".concat(e instanceof Error?e.message:"Unknown error")),b(!1)}},P=()=>{if(!g||c)return;let e=v.getCurrentTime();window.electron.handlePinPress(e)};return((0,a.useEffect)(()=>{(async()=>{if(!r){console.error("No chart selected, returning to select screen."),n();return}try{if(y(!0),console.log("[Renderer] Loading PinChart:",r),!r||!r.notes||0===r.notes.length){console.error("[Renderer] CRITICAL: Chart data is missing or notes are empty!"),alert("Chart data is invalid. Returning to selection."),n();return}if(console.log("[Renderer] Chart validation passed - notes count:",r.notes.length),f(r),r.audioFilename){let e=r.audioFilename;!e.includes("://")&&r.folderPath&&(e="".concat(r.folderPath,"/").concat(e)),console.log("[GameScene] Loading main audio: ".concat(e)),await v.loadAudio(e)}let e=async(e,t)=>{if(r.folderPath)try{let s="".concat(r.folderPath,"/").concat(t);await window.electron.assetExists(s)&&(await v.loadHitsound(e,s),console.log("[AssetLoad] Successfully loaded sound: ".concat(s," as '").concat(e,"'")))}catch(e){console.warn("Could not load optional sound asset: ".concat(t),e)}};if(await e("normal-hitnormal","normal-hitnormal.wav"),await e("combobreak","combobreak.wav"),await e("normal-hitwhistle","normal-hitwhistle.wav"),r.videoPath)N(r.videoPath),C(null);else if(r.backgroundPath){N(null);try{let e=await window.electron.loadAsset(r.backgroundPath),t=new Blob([e],{type:"image/jpeg"}),s=URL.createObjectURL(t);C(s)}catch(e){console.error("Failed to load background image:",e),C(null)}}else N(null),C(null);y(!1)}catch(e){console.error("CRITICAL: Failed to load game assets. Aborting game.",e);try{window.electron.stopGame()}catch(e){console.error("Failed to stop game in main process:",e)}alert("Failed to load game assets: ".concat(e instanceof Error?e.message:"Unknown error","\n\nReturning to song selection.")),n()}})()},[null==r?void 0:r.id]),(0,a.useEffect)(()=>{let e=window.electron.onGameUpdate(e=>{d(e)});return()=>{e(),v.stop()}},[]),(0,a.useEffect)(()=>{let e=e=>{g&&!c&&"Space"===e.code&&(e.preventDefault(),P())};return g&&!c&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g,c]),(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.code&&(e.preventDefault(),h())};return g&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g,h]),g)?c?(0,s.jsx)(A,{onResume:h,onRestart:()=>{u(),h(),S()},onBackToMenu:()=>{u(),h(),n()}}):(0,s.jsxs)("div",{className:"relative w-full h-screen overflow-hidden bg-black",children:[w?(0,s.jsx)(M,{videoPath:w},w):k?(0,s.jsx)("div",{className:"absolute inset-0 z-0 bg-cover bg-center",style:{backgroundImage:"url(".concat(k,")")}}):(0,s.jsx)("div",{className:"absolute inset-0 z-0 bg-gray-900"}),x&&("osu"===x.gameMode?(0,s.jsx)(L,{chart:x}):(0,s.jsx)(j,{chart:x,onPinThrow:P,score:l,combo:o,judgment:i,noteSpeed:500})),(0,s.jsxs)("div",{className:"absolute top-4 right-4 bg-black/50 text-white p-2 text-sm z-50",children:[(0,s.jsxs)("div",{children:["Chart: ",(null==x?void 0:x.title)||"None"]}),(0,s.jsxs)("div",{children:["Notes: ",(null==x||null==(t=x.notes)?void 0:t.length)||0]}),(0,s.jsxs)("div",{children:["Game Started: ",g?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Loading: ",p?"Yes":"No"]}),(0,s.jsxs)("div",{children:["Audio Time: ",v.getCurrentTime().toFixed(2),"s"]})]})]}):(0,s.jsx)(T,{chart:x,isLoading:p,onStartGame:S,onBackToMenu:n})};var G=r(8723);let F=e=>{let{score:t,maxCombo:r}=e,{rank:a,color:n}=(e=>e>95e4?{rank:"S",color:"text-theme-highlight"}:e>9e5?{rank:"A",color:"text-theme-primary"}:e>8e5?{rank:"B",color:"text-theme-primary/80"}:e>7e5?{rank:"C",color:"text-theme-text-dark"}:{rank:"D",color:"text-theme-accent"})(t);return(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-2xl text-theme-text-dark font-medium mb-2",children:"FINAL SCORE"}),(0,s.jsx)("p",{className:"text-8xl font-black text-transparent bg-gradient-to-r from-theme-primary to-theme-secondary bg-clip-text mb-4",children:t.toLocaleString()}),(0,s.jsxs)("div",{className:"flex justify-center items-baseline gap-8 text-theme-text-light",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-lg text-theme-text-dark",children:"RANK"}),(0,s.jsx)("p",{className:"text-5xl font-bold ".concat(n),children:a})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-lg text-theme-text-dark",children:"MAX COMBO"}),(0,s.jsx)("p",{className:"text-5xl font-bold",children:r})]})]})]})},I={KOOL:"text-theme-highlight",COOL:"text-theme-primary",GOOD:"text-green-400",MISS:"text-theme-accent"},B=e=>{let{judgments:t}=e;return(0,s.jsx)("div",{className:"grid grid-cols-4 gap-4 text-center",children:["KOOL","COOL","GOOD","MISS"].map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-lg ".concat(I[e]," font-bold"),children:e}),(0,s.jsx)("p",{className:"text-3xl font-semibold text-theme-text-light",children:t[e]})]},e))})},z=e=>{let{label:t,onClick:r,variant:a}=e;return(0,s.jsx)("button",{onClick:r,className:"".concat("px-8 py-3 rounded-xl transition-all duration-200 font-medium transform hover:scale-105"," ").concat({primary:"bg-theme-primary/20 hover:bg-theme-primary/30 border border-theme-primary/50 text-theme-primary hover:text-theme-primary/90",secondary:"bg-theme-text-dark/30 hover:bg-theme-text-dark/50 text-theme-text-light/80 hover:text-theme-text-light"}[a]),children:t})},D=e=>{let{onRestart:t,onSelectMusic:r}=e;return(0,s.jsx)("div",{className:"flex justify-center gap-6",children:[{label:"Retry",onClick:t,variant:"primary"},{label:"Back to Menu",onClick:r,variant:"secondary"}].map(e=>(0,s.jsx)(z,{...e},e.label))})},K={S:"text-yellow-400",A:"text-green-400",B:"text-blue-400",C:"text-purple-400",D:"text-gray-500"},U=e=>{let{rank:t}=e,r=K[t]||"text-gray-500";return(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("p",{className:"text-2xl font-semibold text-theme-text-light/80 mb-2",children:"Rank"}),(0,s.jsx)("div",{className:"text-9xl font-black ".concat(r," transform-gpu transition-all duration-500"),style:{filter:"drop-shadow(0 0 20px ".concat(r.replace("text-","bg-").split("-")[0],")")},children:t})]})},_=e=>{let{accuracy:t}=e,r=2*Math.PI*60,{val:a}=(0,G.zh)({from:{val:0},to:{val:t},config:{duration:1e3}}),{strokeDashoffset:n}=(0,G.zh)({from:{strokeDashoffset:r},to:{strokeDashoffset:r-t/100*r},config:{duration:1e3}});return(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("p",{className:"text-2xl font-semibold text-theme-text-light/80 mb-4",children:"Accuracy"}),(0,s.jsxs)("div",{className:"relative w-40 h-40",children:[(0,s.jsxs)("svg",{className:"w-full h-full",viewBox:"0 0 140 140",children:[(0,s.jsx)("circle",{cx:"70",cy:"70",r:60,strokeWidth:"10",className:"stroke-current text-theme-text-dark/30",fill:"transparent"}),(0,s.jsx)(G.CS.circle,{cx:"70",cy:"70",r:60,strokeWidth:"10",className:"stroke-current text-theme-accent transform -rotate-90 origin-center",fill:"transparent",strokeDasharray:r,strokeDashoffset:n,strokeLinecap:"round"})]}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)(G.CS.p,{className:"text-4xl font-bold text-theme-text-light",children:a.to(e=>"".concat(e.toFixed(2),"%"))})})]})]})},V=e=>{let{onBack:t}=e,{score:r,maxCombo:n,judgments:l,reset:o,setCurrentScene:i}=m(),[c,d]=(0,a.useState)(0),[h,u]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=(e=>{let t=e.KOOL+e.COOL+e.GOOD+e.MISS;return 0===t?0:parseFloat(((+e.KOOL+.5*e.COOL+.25*e.GOOD)/t*100).toFixed(2))})(l),t=(e=>e>=98?"S":e>=95?"A":e>=90?"B":e>=80?"C":"D")(e);d(e),u(t)},[l]);let x=()=>{o(),i("Game")},f=()=>{o(),i("Select")},g=[e=>(0,s.jsx)(G.CS.div,{style:e,children:(0,s.jsx)(F,{score:r,maxCombo:n})}),e=>(0,s.jsx)(G.CS.div,{style:e,children:(0,s.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,s.jsx)(G.CS.div,{style:e,children:(0,s.jsxs)("div",{className:"flex justify-around items-center",children:[(0,s.jsx)(U,{rank:h}),(0,s.jsx)(_,{accuracy:c})]})}),e=>(0,s.jsx)(G.CS.div,{style:e,children:(0,s.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,s.jsx)(G.CS.div,{style:e,children:(0,s.jsx)(B,{judgments:l})}),e=>(0,s.jsx)(G.CS.div,{style:e,children:(0,s.jsx)("div",{className:"w-full h-px bg-theme-text-dark/50"})}),e=>(0,s.jsx)(G.CS.div,{style:e,children:(0,s.jsx)(D,{onRestart:x,onSelectMusic:f})})],b=(0,G.pn)(g,{from:{opacity:0,transform:"translateY(20px)"},enter:{opacity:1,transform:"translateY(0px)"},trail:200});return(0,s.jsx)("div",{className:"min-h-screen bg-theme-bg flex items-center justify-center p-8",children:(0,s.jsxs)("div",{className:"bg-theme-bg/70 backdrop-blur-xl rounded-3xl p-12 border border-theme-text-dark/50 shadow-2xl max-w-3xl w-full space-y-8",children:[(0,s.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"Back to Menu"}),(0,s.jsx)("h1",{className:"text-6xl font-black text-center bg-clip-text text-transparent bg-gradient-to-b from-theme-accent to-theme-secondary animate-pulse",children:"GAME CLEAR"}),b((e,t)=>t(e))]})})},W=e=>{let{label:t,value:r,min:a,max:n,step:l,onChange:o}=e;return(0,s.jsxs)("div",{className:"setting-item",children:[(0,s.jsxs)("label",{htmlFor:t,className:"text-2xl font-semibold mb-4 flex justify-between items-center",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"text-3xl font-bold text-theme-secondary bg-theme-bg/50 px-4 py-1 rounded-lg",children:r})]}),(0,s.jsx)("input",{type:"range",id:t,min:a,max:n,step:l,value:r,onChange:o,className:"w-full h-3 bg-theme-text-light/10 rounded-full appearance-none cursor-pointer range-lg accent-theme-accent focus:outline-none focus:ring-2 focus:ring-theme-secondary focus:ring-opacity-50 transition-all duration-300"})]})},H=e=>{let{label:t,value:r}=e;return(0,s.jsxs)("div",{className:"opacity-50",children:[(0,s.jsxs)("label",{className:"text-2xl font-semibold mb-4 flex justify-between items-center",children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"text-3xl font-bold text-theme-secondary bg-theme-bg/50 px-4 py-1 rounded-lg",children:r})]}),(0,s.jsx)("input",{type:"range",disabled:!0,className:"w-full h-3 bg-theme-text-light/10 rounded-full appearance-none cursor-not-allowed"}),(0,s.jsx)("p",{className:"text-sm text-right mt-2",children:"Coming Soon"})]})},Y=[{id:"noteSpeed",label:"Note Speed",min:100,max:1e3,step:50,enabled:!0}],q=e=>{let{onBack:t}=e;m(e=>e.setCurrentScene);let[r,n]=(0,a.useState)({});return(0,a.useEffect)(()=>{(async()=>{let e={};for(let t of Y)t.enabled&&(e[t.id]=await window.electron.getSetting(t.id));n(e)})()},[]),(0,s.jsxs)("div",{className:"min-h-screen bg-theme-bg text-theme-text-light flex flex-col items-center justify-center p-8",children:[(0,s.jsx)("div",{className:"absolute top-8 left-8",children:(0,s.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"Back to Menu"})}),(0,s.jsxs)("div",{className:"w-full max-w-2xl bg-theme-bg/70 backdrop-blur-xl rounded-2xl shadow-2xl p-10 border border-theme-text-dark/50",children:[(0,s.jsx)("h1",{className:"text-5xl font-bold text-center mb-12 bg-clip-text text-transparent bg-gradient-to-r from-theme-secondary to-theme-accent animate-pulse",children:"Settings"}),(0,s.jsx)("div",{className:"space-y-10",children:Y.map(e=>{var t,a,l,o,i;return e.enabled?(0,s.jsx)(W,{label:e.label,value:null!=(a=null!=(t=r[e.id])?t:e.min)?a:0,min:null!=(l=e.min)?l:0,max:null!=(o=e.max)?o:100,step:null!=(i=e.step)?i:1,onChange:t=>((e,t)=>{n({...r,[e]:t}),window.electron.setSetting(e,t)})(e.id,parseInt(t.target.value,10))},e.id):(0,s.jsx)(H,{label:e.label,value:100},e.id)})})]}),(0,s.jsx)("p",{className:"mt-8 text-sm text-theme-text-dark",children:"More settings will be available in future updates."})]})},X=e=>{let{onBack:t,onChartSelected:r}=e,[n,l]=(0,a.useState)([]),[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)("");(0,a.useEffect)(()=>{h()},[]);let h=async()=>{try{let e=await window.electron.getChartLibrary();l(e)}catch(e){console.error("Failed to load chart library:",e)}},u=async()=>{try{i(!0),d("파일 선택 중...");let e=await window.electron.selectOszFile();if(!e){d(""),i(!1);return}d("차트 임포트 중..."),await window.electron.importOszFile(e),d("임포트 완료!"),setTimeout(()=>d(""),2e3),await h()}catch(e){console.error("Failed to import .osz file:",e),d("임포트 실패: "+e.message),setTimeout(()=>d(""),3e3)}finally{i(!1)}},m=async(e,t)=>{try{i(!0),d("차트 변환 중...");let s=await window.electron.convertDifficultyToPinChart(e,t);r(s)}catch(e){console.error("Failed to convert difficulty:",e),d("변환 실패: "+e.message),setTimeout(()=>d(""),3e3)}finally{i(!1)}},x=async e=>{if(confirm("이 차트를 삭제하시겠습니까?"))try{await window.electron.invoke("remove-chart-from-library",e),await h()}catch(e){console.error("Failed to remove chart:",e)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-theme-bg-primary text-white p-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-theme-primary mb-2",children:".osz 차트 라이브러리"}),(0,s.jsx)("p",{className:"text-theme-text-secondary",children:"osu! 비트맵(.osz) 파일을 임포트하여 플레이하세요"})]}),(0,s.jsx)("button",{onClick:t,className:"px-6 py-3 bg-theme-secondary text-white rounded-lg hover:bg-theme-secondary/80 transition-colors",children:"뒤로가기"})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("button",{onClick:u,disabled:o,className:"px-8 py-4 bg-theme-primary text-white rounded-lg hover:bg-theme-primary/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?"처리 중...":".osz 파일 임포트"}),c&&(0,s.jsx)("p",{className:"mt-2 text-theme-accent",children:c})]}),(0,s.jsx)("div",{className:"grid gap-6",children:0===n.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-theme-text-secondary text-lg",children:"임포트된 차트가 없습니다."}),(0,s.jsx)("p",{className:"text-theme-text-secondary mt-2",children:".osz 파일을 임포트하여 시작하세요."})]}):n.map(e=>(0,s.jsxs)("div",{className:"bg-theme-bg-secondary rounded-lg p-6 border border-theme-border",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-theme-primary",children:e.title}),(0,s.jsxs)("p",{className:"text-theme-text-secondary",children:["by ",e.artist," • mapped by ",e.creator]})]}),(0,s.jsx)("button",{onClick:()=>x(e.id),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm",children:"삭제"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:e.difficulties.map((t,r)=>(0,s.jsxs)("button",{onClick:()=>m(e,r),disabled:o,className:"p-4 bg-theme-bg-primary rounded-lg border border-theme-border hover:border-theme-primary transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-left",children:[(0,s.jsx)("div",{className:"font-semibold text-theme-primary",children:t.name}),(0,s.jsxs)("div",{className:"text-sm text-theme-text-secondary mt-1",children:["OD: ",t.overallDifficulty.toFixed(1)," • AR: ",t.approachRate.toFixed(1)]}),(0,s.jsxs)("div",{className:"text-sm text-theme-text-secondary",children:[t.noteCount," 노트"]})]},r))})]},e.id))})]})},Z=()=>{let[e,t]=(0,a.useState)("Start"),[r,n]=(0,a.useState)(null),l=e=>{t(e)},o=e=>{n(e),t("Game")};return(0,s.jsx)("div",{children:(()=>{switch(e){case"Start":default:return(0,s.jsx)(i,{onNavigate:l});case"Select":return(0,s.jsx)(f,{onBack:()=>l("Start"),onChartSelected:o});case"Game":return r?(0,s.jsx)(R,{selectedChart:r,onBack:()=>l("Select")}):(0,s.jsx)(i,{onNavigate:l});case"Finish":return(0,s.jsx)(V,{onBack:()=>l("Start")});case"Settings":return(0,s.jsx)(q,{onBack:()=>l("Start")});case"OszImport":return(0,s.jsx)(X,{onBack:()=>l("Start"),onChartSelected:o})}})()})};function J(){return(0,s.jsx)(Z,{})}}},e=>{e.O(0,[710,587,18,358],()=>e(e.s=374)),_N_E=e.O()}]);